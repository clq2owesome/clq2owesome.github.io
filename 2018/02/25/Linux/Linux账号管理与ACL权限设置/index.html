<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Linux账号管理与ACL权限设置 | LeoChan&#39;s 个人博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="用户账号跟用户有关有两个非常重要的文件，一个是管理用户UID/GID重要参数的/etc/passwd，一个则是专门管理密码相关数据的/etc/shadow /etc/passwd文件结构12345678910111213141516cat /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbi">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux账号管理与ACL权限设置">
<meta property="og:url" content="https://clq2owesome.github.io/2018/02/25/Linux/Linux账号管理与ACL权限设置/index.html">
<meta property="og:site_name" content="LeoChan&#39;s 个人博客">
<meta property="og:description" content="用户账号跟用户有关有两个非常重要的文件，一个是管理用户UID/GID重要参数的/etc/passwd，一个则是专门管理密码相关数据的/etc/shadow /etc/passwd文件结构12345678910111213141516cat /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbi">
<meta property="og:updated_time" content="2018-02-25T07:50:56.957Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Linux账号管理与ACL权限设置">
<meta name="twitter:description" content="用户账号跟用户有关有两个非常重要的文件，一个是管理用户UID/GID重要参数的/etc/passwd，一个则是专门管理密码相关数据的/etc/shadow /etc/passwd文件结构12345678910111213141516cat /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbi">
  
    <link rel="alternate" href="/atom.xml" title="LeoChan&#39;s 个人博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">LeoChan&#39;s 个人博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">技术都是通用的，重要的是是否具有自主解决问题的能力！</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://clq2owesome.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Linux/Linux账号管理与ACL权限设置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/25/Linux/Linux账号管理与ACL权限设置/" class="article-date">
  <time datetime="2018-02-25T02:09:45.000Z" itemprop="datePublished">2018-02-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Linux账号管理与ACL权限设置
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="用户账号"><a href="#用户账号" class="headerlink" title="用户账号"></a>用户账号</h3><p>跟用户有关有两个非常重要的文件，一个是管理用户UID/GID重要参数的<code>/etc/passwd</code>，一个则是专门管理密码相关数据的<code>/etc/shadow</code></p>
<h4 id="etc-passwd文件结构"><a href="#etc-passwd文件结构" class="headerlink" title="/etc/passwd文件结构"></a>/etc/passwd文件结构</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">cat /etc/passwd</div><div class="line">root:x:0:0:root:/root:/bin/bash</div><div class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</div><div class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</div><div class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</div><div class="line">sync:x:4:65534:sync:/bin:/bin/sync</div><div class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</div><div class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</div><div class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</div><div class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</div><div class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</div><div class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</div><div class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</div><div class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</div><div class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</div><div class="line">......</div></pre></td></tr></table></figure>
<p>每一行都代表一个账号，有几行就代表有几个账号在你的系统中！不过需要特别留意的是，里面很多账号本来就是系统正常运行所必须要的，我们可以简称它为系统账号，例如bin，daemon，adm，nobody等，这些账号请不要随意删除</p>
<p>每一行使用“:”分隔开，共有七个字段，分别是：</p>
<ol>
<li>账号名称<br>就是账号，对应UID</li>
<li>密码<br>这个字段的密码数据放到<code>/etc/shadow</code>中，所以这里会显示一个x</li>
<li>UID<br>用户标识符</li>
</ol>
<table>
<thead>
<tr>
<th>ID范围</th>
<th>该ID用户特性</th>
</tr>
</thead>
<tbody>
<tr>
<td>0（系统管理员）</td>
<td>当UID是0时，代表这个账号是“系统管理员”，所以当你要让其他的账号名称也具有root的权限时，该账号的UID改为0即可。这也就是说，一个系统上面的系统管理员不见得只有root，不过，很不建议有多个账号的UID是0</td>
</tr>
<tr>
<td>1～499（系统账号）</td>
<td>保留给系统使用的ID，其实除了0之外，其他的UID权限与特性并没有不一样。默认500以下的数字让给系统作为保留账号只是一个习惯。<br>由于系统上面启动的服务希望使用较小的权限去运行，因此不希望用root的身份去执行这些服务，所以我们就得要提供这些运行中程序的所有者账号才行。这些系统账号通常是不可登录的。<br>根据系统账号的由来，通常系统账号又被分为两种：<br>1～99:由distributions自行创建的系统账号<br>100～499:若用户有系统账号的需求时，可以使用的账号UID</td>
</tr>
<tr>
<td>500～65535（可登录账号）</td>
<td>给一般用户用的。事实上，目前的Linux内核（2.6.x版）已经可以支持到2^32-1这么大的UID号码</td>
</tr>
</tbody>
</table>
<ol>
<li>GID<br>组ID</li>
<li>用户信息说明列<br>这个字段基本上并没有什么重要用途，只是用来解释这个账号的意义而已</li>
<li>主文件夹<br>这是用户的主文件夹。以上面为例，root的主文件夹是在<code>/root</code>中，所以当root登录之后，就会立刻跑到<code>/root</code>目录里面。<strong>默认的用户主文件夹在<code>/home/yourIDname</code>中</strong></li>
<li>shell<br>当用户登录系统后就会取得一个shell来与系统的内核通信以进行用户的操作任务。那为何默认shell会使用bash呢？就是在这个字段指定的。这里比较需要注意的是，有一个shell可以用来替代成让账号无法取得shell环境的登录操作，那就是<code>/sbin/nologin</code></li>
</ol>
<h4 id="etc-shadow文件结构"><a href="#etc-shadow文件结构" class="headerlink" title="/etc/shadow文件结构"></a>/etc/shadow文件结构</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">root@iZwz9hwmk5t4idn4oxa4okZ:/usr/share# cat /etc/shadow</div><div class="line">root:$6$rrwxtIVE$BIRVo2hygttfTZvNINNT3TL5Qbp.QaUC7px/jkC/nEp4gtluaVIUs56DzYxkZiE4lQefSw8OmX9Nn5lCQa2Sc.:17204:0:99999:7:::</div><div class="line">daemon:*:17001:0:99999:7:::</div><div class="line">bin:*:17001:0:99999:7:::</div><div class="line">sys:*:17001:0:99999:7:::</div><div class="line">sync:*:17001:0:99999:7:::</div><div class="line">games:*:17001:0:99999:7:::</div><div class="line">man:*:17001:0:99999:7:::</div><div class="line">lp:*:17001:0:99999:7:::</div><div class="line">mail:*:17001:0:99999:7:::</div><div class="line">news:*:17001:0:99999:7:::</div><div class="line">uucp:*:17001:0:99999:7:::</div><div class="line">proxy:*:17001:0:99999:7:::</div><div class="line">www-data:*:17001:0:99999:7:::</div><div class="line">backup:*:17001:0:99999:7:::</div></pre></td></tr></table></figure>
<p>shadow同样是以“:”分隔，有9个字段，分别是：</p>
<ol>
<li>账号名称<br>由于密码也需要与账号对应</li>
<li>密码     </li>
<li>最近更改密码的日期</li>
<li>密码不可被更改的天数（与第3个字段相比）</li>
<li>密码需要重新更改的天数（与第3个字段相比）</li>
<li>密码需要更改期限前的警告天数（与第5个字段相比）</li>
<li>密码过期后的账号宽限时间(密码失效日)（与第5个字段相比）</li>
<li>账号失效日期</li>
<li>保留</li>
</ol>
<h3 id="有效与初始用户组：groups，newgrp"><a href="#有效与初始用户组：groups，newgrp" class="headerlink" title="有效与初始用户组：groups，newgrp"></a>有效与初始用户组：groups，newgrp</h3><h6 id="etc-group文件结构"><a href="#etc-group文件结构" class="headerlink" title="/etc/group文件结构"></a>/etc/group文件结构</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"># cat /etc/group</div><div class="line">root:x:0:</div><div class="line">daemon:x:1:</div><div class="line">bin:x:2:</div><div class="line">sys:x:3:</div><div class="line">adm:x:4:syslog</div><div class="line">tty:x:5:</div><div class="line">ssh:x:113:</div><div class="line">ntp:x:114:</div><div class="line">lpadmin:x:115:</div><div class="line">stapdev:x:116:</div><div class="line">stapusr:x:117:</div><div class="line">stapsys:x:118:</div><div class="line">mysql:x:119:</div><div class="line">redis:x:120:</div><div class="line">activemq:x:121:</div><div class="line">tomcat7:x:122:tomcat7</div><div class="line">tomcat:x:1000:</div><div class="line">jenkins:x:123:</div><div class="line">git:x:1001:</div></pre></td></tr></table></figure>
<ol>
<li>用户组名称</li>
<li>用户组密码</li>
<li>GID</li>
<li>此用户组支持的账号名称</li>
</ol>
<h5 id="groups：有效与支持用户组的查看"><a href="#groups：有效与支持用户组的查看" class="headerlink" title="groups：有效与支持用户组的查看"></a>groups：有效与支持用户组的查看</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># groups</div><div class="line">root</div></pre></td></tr></table></figure>
<p>第一个输出的用户组即为有效用户组，通常有效用户组的作用是新建文件</p>
<h5 id="newgrp：有效用户组的切换"><a href="#newgrp：有效用户组的切换" class="headerlink" title="newgrp：有效用户组的切换"></a>newgrp：有效用户组的切换</h5><p>使用newgrp是有限制的，那就是你想要切换的用户组必须是你已经有支持的用户组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">newgrp 用户组名称</div></pre></td></tr></table></figure></p>
<p>这个命令可以改变目前用户的有效用户组，而且是以另外一个新的shell来提供这个功能的，输入exit可以回到原本的shell<br>​<br>虽然用户的环境设置（如环境变量等其他数据）不会有影响，但是用户的“用户组权限”将会重新被计算</p>
<h3 id="账号管理"><a href="#账号管理" class="headerlink" title="账号管理"></a>账号管理</h3><h4 id="新增用户"><a href="#新增用户" class="headerlink" title="新增用户"></a>新增用户</h4><p>使用useradd来新建用户，密码的给予则使用passwd这个命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">useradd [-u UID] [-g 初始用户组] [-G 次要用户组] [-mM] </div><div class="line">[-c 说明栏] [-d 主文件夹绝对路径] [-s shell] 用户账户名</div><div class="line">-u：后面接的是UID，是一组数字，直接指定一个特定的UID给这个账号</div><div class="line">-g：后面接的那个用户组名就是初始用户组，该永辉组的GID会被放置到/etc/passwd的第四个字段内</div><div class="line">-G：后面接的组名则是这个账号还可以加入的用户组，这个参数会修改/etc/group内的相关数据</div><div class="line">-M：强制！不要创建用户主文件夹（系统账号默认值）</div><div class="line">-m：强制！要创建用户主文件夹（一般账号默认值）</div><div class="line">-c：这个就是/etc/passwd的第五列的说明内容，</div><div class="line">-d：指定某个目录成为主文件夹，而不要使用默认值，务必使用绝对路径</div><div class="line">-r：创建一个系统的账号，这个账号的UID会有限制</div><div class="line">-s：后面接一个shell，若没有指定则默认是/bin/bash</div><div class="line">-e：后面接一个日期，格式为“YYYY-MM-DD”，此选项可以写入shadow的第八字段，即账号失效日的设置选项</div><div class="line">-f：后面接shadow的第七字段选项，指定密码是否会失效，0为立刻失效，-1为永远不失效（密码只会过期而强制于登录时重新设置而已）</div><div class="line"></div><div class="line"></div><div class="line">例如：完全参考默认值新建一个用户，名称为test</div><div class="line"># useradd test</div><div class="line"># ll -d /home/test</div><div class="line">drwx------ 4 test test 4096 Feb 25 09:38 /home/test</div><div class="line"># 默认会创建用户主文件夹，且权限为700！这是重点！</div><div class="line"># 默认会创建一个与账号一模一样的用户组名</div></pre></td></tr></table></figure></p>
<p>CentOS这些默认值主要会帮我们处理几个项目：</p>
<ol>
<li>在/etc/passwd里面创建一行与账号相关的数据，包括创建UID/GID/主文件夹等</li>
<li>在/etc/shadow里面将此账号的密码相关参数填入，但是尚未有密码</li>
<li>在/etc/group里面加入一个与账号名称一模一样的组名</li>
<li>在/home下面创建一个与账号同名的目录作为用户主文件夹，且权限为700</li>
</ol>
<h5 id="useradd-参考文件"><a href="#useradd-参考文件" class="headerlink" title="useradd 参考文件"></a>useradd 参考文件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># useradd -D</div><div class="line">GROUP=100 &lt;==默认的用户组</div><div class="line">HOME=/home &lt;==默认的主文件夹所在的目录</div><div class="line">INACTIVE=-1 &lt;==密码失效日，在shadow内的第7列</div><div class="line">EXPIRE= &lt;==账号失效日，在shadow内的第8列</div><div class="line">SHELL=/bin/sh &lt;==默认的shell</div><div class="line">SKEL=/etc/skel &lt;==用户主文件夹的内容数据参考目录</div><div class="line">CREATE_MAIL_SPOOL=no &lt;==是否主动帮用户创建邮件信箱</div></pre></td></tr></table></figure>
<p>这个数据其实是由/etc/default/useradd调用出来的</p>
<p>系统上面的GID为100即是users这个用户组，此设置项目指的就是让新设用户账号的初始用户组为users这个意思。但是我们知道CentOS上面并不是这样的，在CentOS上面默认的用户组为与账户名相同的用户组。这是因为针对用户组的角度两种不同的机制所致，这两种机制分别是：</p>
<ul>
<li><code>私有用户组机制</code>：系统会创建一个与账号一样的用户组给用户作为初始用户组。这种用户组的设置机制会比较有保密性，这是因为用户都有自己的用户组，而且主文件夹的权限将会设置为700（仅有自己可进入自己的主文件夹）。使用这种机制将不会参考GROUP=100这个设置值</li>
<li><code>公共用户组机制</code>：就是以GROUP=100这个设置值作为新建账号的初始用户组，因此每个账号都属于users这个用户组，且默认主文件夹通常的权限会是“drwxr-xr-x”,由于每个账号都属于users用户组，因此大家都可以互相分享主文件夹内的数据</li>
</ul>
<h5 id="设置用户密码：passwd"><a href="#设置用户密码：passwd" class="headerlink" title="设置用户密码：passwd"></a>设置用户密码：passwd</h5><p>使用useradd创建了账号之后，在默认的情况下，该账号是暂时被封锁的，也就是说，该账号是无法登录的，设置密码以后就可以正常的登录了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># passwd [--stdin] &lt;==所有人均可使用来改自己的密码</div><div class="line"># passwd [-l] [-u] [--stdin] [-S] [-n 日数] [-x 日数] [-w 日数] [-i 日数] [-i 日期] 账号 &lt;==root功能</div><div class="line">参数：</div><div class="line">--stdin：可以通过来自前一个管道的数据，作为密码输入，对shell script有帮助！</div><div class="line">-l：是Lock的意思，会将/etc/shadow第二列最前面加上！使密码失效</div><div class="line">-u：与-l相对，是unlock的意思</div><div class="line">-S：列出密码相关参数，即shadow文件内的大部分信息</div><div class="line">-n：shadow的第4个字段，多久不可修改密码天数</div><div class="line">-x：shadow的第5个字段，多久内必须要改动密码</div><div class="line">-w：shadow的第6个字段，密码过期前的警告天数</div><div class="line">-i：shadow的第7个字段，密码失效日期</div></pre></td></tr></table></figure></p>
<p>要帮一般账号新建密码需要使用“passwd 账号”的格式，使用“passwd”表示修改自己的密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 使用standard input新建用户的密码</div><div class="line"># echo &quot;密码&quot; | passwd --stdin 账号</div></pre></td></tr></table></figure></p>
<h5 id="密码参数显示和修改功能：chage"><a href="#密码参数显示和修改功能：chage" class="headerlink" title="密码参数显示和修改功能：chage"></a>密码参数显示和修改功能：chage</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># chage [-ldEImMW] 账号名</div><div class="line">参数：</div><div class="line">-l：列出该账号的详细密码参数</div><div class="line">-d：后面接日期，修改shadow的第三字段（最近一次更改密码的日期），格式为YYYY-MM-DD</div><div class="line">-E：后面接日期，修改shadow的第八字段（账号失效日）</div><div class="line">-I：后面接日期，修改shadow的第七字段（密码失效日期）</div><div class="line">-m：后面接日期，修改shadow的第四字段（密码最短保留天数）</div><div class="line">-M：后面接日期，修改shadow的第五字段（密码多久需要进行更改）</div><div class="line">-W：后面接日期，修改shadow的第六字段（密码过期前警告日期）</div></pre></td></tr></table></figure>
<p>让用户在第一次登录时强制他们一定要更改密码后才能够使用系统资源<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># useradd agetest</div><div class="line"># echo &quot;agetest&quot; | passwd --stdin agetest</div><div class="line"># chage -d 0 agetest</div></pre></td></tr></table></figure></p>
<h5 id="用户调整：usermod"><a href="#用户调整：usermod" class="headerlink" title="用户调整：usermod"></a>用户调整：usermod</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"># usermod [-cdegGlsuLU] username</div><div class="line">参数：</div><div class="line">-c：后面接账号的说明，即/etc/passwd 第五列的说明</div><div class="line">-d：修改账户的主文件夹</div><div class="line">-e：修改账号失效日期，格式为YYYY-MM-DD</div><div class="line">-f：修改密码失效日期</div><div class="line">-g：修改用户初始化用户组</div><div class="line">-G：修改用户次要用户组</div><div class="line">-a：与-G合用可增加次要用户组的支持而非设置</div><div class="line">-l：修改账号名称</div><div class="line">-s：修改shell</div><div class="line">-u：修改UID数字</div><div class="line">-L：暂时将用户的密码冻结，让他无法登录，其实仅改/etc/shadow的密码</div><div class="line">-U：将/etc/shadow 密码列的!去掉</div></pre></td></tr></table></figure>
<h5 id="删除用户：userdel"><a href="#删除用户：userdel" class="headerlink" title="删除用户：userdel"></a>删除用户：userdel</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># userdel [-r] username</div><div class="line">参数：</div><div class="line">-r：连同用户的主文件夹也一起删除</div></pre></td></tr></table></figure>
<h3 id="用户功能"><a href="#用户功能" class="headerlink" title="用户功能"></a>用户功能</h3><h4 id="查阅用户相关信息：finger"><a href="#查阅用户相关信息：finger" class="headerlink" title="查阅用户相关信息：finger"></a>查阅用户相关信息：finger</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># finger [-s] username</div><div class="line">参数：</div><div class="line">-s：仅列出用户的账号，全名，终端机代号与登录时间等</div><div class="line">-m：列出与后面接的账号相同者，而不是利用部分对比（包括全名部分）</div><div class="line"></div><div class="line">例子：查看目前系统上面登录的用户与登录时间</div><div class="line"># finger</div><div class="line">Login     Name       Tty      Idle  Login Time   Office     Office Phone</div><div class="line">root      root      *pts/0          Jan  3 09:56 (210.21.9.252)</div></pre></td></tr></table></figure>
<h4 id="修改个人属性：chfn"><a href="#修改个人属性：chfn" class="headerlink" title="修改个人属性：chfn"></a>修改个人属性：chfn</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># chfn [-foph] [账号名]</div><div class="line">参数：</div><div class="line">-f：后面接完整的大名</div><div class="line">-o：办公室房间号码</div><div class="line">-p：办公室电话号码</div><div class="line">-h：家里的电话号码</div></pre></td></tr></table></figure>
<h4 id="修改shell：chsh"><a href="#修改shell：chsh" class="headerlink" title="修改shell：chsh"></a>修改shell：chsh</h4><p>change shell<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># chsh [-ls]</div><div class="line">参数：</div><div class="line">-l：列出目前系统上面可用的shell，其实就是/etc/shells的内容</div><div class="line">-s：设置修改自己的shell</div></pre></td></tr></table></figure></p>
<h4 id="查询某人或自己的相关UID-GID等信息"><a href="#查询某人或自己的相关UID-GID等信息" class="headerlink" title="查询某人或自己的相关UID/GID等信息"></a>查询某人或自己的相关UID/GID等信息</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># id [username]</div><div class="line"></div><div class="line"># id</div><div class="line">uid=0(root) gid=0(root) groups=0(root)</div></pre></td></tr></table></figure>
<h3 id="新增和删除用户组"><a href="#新增和删除用户组" class="headerlink" title="新增和删除用户组"></a>新增和删除用户组</h3><h4 id="groupadd"><a href="#groupadd" class="headerlink" title="groupadd"></a>groupadd</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># groupadd [-g gid] [-r] 用户组名</div><div class="line">参数：</div><div class="line">-g：后面接某个特定的GID，用来直接给予某个GID</div><div class="line">-r：新建系统用户组。与/etc/login.defs 内的GID_MIN 有关</div><div class="line"></div><div class="line">例如：</div><div class="line"># groupadd group1</div><div class="line"># grep group1 /etc/group /etc/gshadow</div><div class="line">/etc/group:group1:x702:</div><div class="line">/etc/gshadow:group1:!::</div></pre></td></tr></table></figure>
<h4 id="groupmod"><a href="#groupmod" class="headerlink" title="groupmod"></a>groupmod</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># groupmod [-g gid] [-n group_name] 用户组名</div><div class="line">参数：</div><div class="line">-g：修改既有的GID数字</div><div class="line">-n：修改既有的组名</div></pre></td></tr></table></figure>
<h4 id="groupdel"><a href="#groupdel" class="headerlink" title="groupdel"></a>groupdel</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># groupdel [groupname]</div></pre></td></tr></table></figure>
<h4 id="用户组管理员功能：gpasswd"><a href="#用户组管理员功能：gpasswd" class="headerlink" title="用户组管理员功能：gpasswd"></a>用户组管理员功能：gpasswd</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"># 关于系统管理员（root）做的动作</div><div class="line"># gpasswd groupname</div><div class="line"># gpasswd [-A user1,...] [-M user3,...] groupname</div><div class="line"># gpasswd [-rR] groupname</div><div class="line">参数：</div><div class="line">若没有任何参数时，表示给予groupname一个密码（/etc/gshadow）</div><div class="line">-A：将groupname的主控权交由后面的用户管理（该用户组的管理员）</div><div class="line">-M：将某些账号加入这个用户组当中</div><div class="line">-r：将groupname的密码删除</div><div class="line">-R：让groupname的密码栏失效</div><div class="line"></div><div class="line"># 关于用户组管理员（group administrator）做到操作：</div><div class="line"># gpasswd [-ad] user groupname</div><div class="line">参数：</div><div class="line">-a：将某位用户加入到groupname这个用户组当中</div><div class="line">-d：将某位用户删除出groupname这个用户组当中</div><div class="line"></div><div class="line">例如：新建一个新用户组，并交有test管理</div><div class="line"># groupadd testgroup</div><div class="line"># gpasswd -A test testgroup</div></pre></td></tr></table></figure>
<h3 id="主机的具体权限规划：ACL的使用"><a href="#主机的具体权限规划：ACL的使用" class="headerlink" title="主机的具体权限规划：ACL的使用"></a>主机的具体权限规划：ACL的使用</h3><p>ACL是Access Control List的缩写，主要的目的是提供传统的owner，grooup，others的read，write，execute权限之外的具体权限设置。ACL可以针对单一用户，单一文件或目录来进行r，w，x的权限设置，对于需要特殊权限的使用状况非常有帮助</p>
<p>ACL主要针对以下几个方面来控制权限：</p>
<ul>
<li>用户（user）：可以针对用户来设置权限</li>
<li>用户组（group）：针对用户组来设置其权限</li>
<li>默认属性（mask）：还可以在该目录下在新建文件/目录时设置新数据的默认权限</li>
</ul>
<h4 id="ACL的设置技巧：getfacl，setfacl"><a href="#ACL的设置技巧：getfacl，setfacl" class="headerlink" title="ACL的设置技巧：getfacl，setfacl"></a>ACL的设置技巧：getfacl，setfacl</h4><h5 id="设置某个目录-文件的ACL规定-setfacl"><a href="#设置某个目录-文件的ACL规定-setfacl" class="headerlink" title="设置某个目录/文件的ACL规定:setfacl"></a>设置某个目录/文件的ACL规定:setfacl</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"># setfacl [-bkRd] [&#123;-m|-x&#125; acl参数] 目标文件名</div><div class="line">参数：</div><div class="line">-m：设置后续的acl参数给文件使用，不可与-x使用</div><div class="line">-x：删除后续的acl参数，不可与-m合用</div><div class="line">-b：删除所有的ACL设置参数</div><div class="line">-k：删除默认的ACL参数</div><div class="line">-R：递归设置acl，亦即包括子目录都会被设置起来</div><div class="line">-d：设置默认acl参数!只对目录有效，在该目录新建的数据会引用此默认值</div><div class="line"></div><div class="line"></div><div class="line"># 1.针对单一用户的设置方式：</div><div class="line"># 设置规定：“u:[用户账号列表]:[rwx]”</div><div class="line"># touch acl_test1</div><div class="line"># ll acl_test1</div><div class="line">-rw-r--r-- 1 root root 0 Jan  3 11:08 acl_test1</div><div class="line"># setfacl -m u:test:rx acl_test1</div><div class="line"># ll acl_test1</div><div class="line">-rw-r-xr--+ 1 root root 0 Jan  3 11:08 acl_test1*</div><div class="line"># 权限部分多了个+，且与原本的权限（644）看起来区别很大</div><div class="line"></div><div class="line"># 2.针对特定用户组的方式</div><div class="line"># 设置规范“g:[用户组列表]:[rwx]”</div><div class="line"></div><div class="line"># 3.针对有效权限mask的设置方式</div><div class="line"># 设置规范“m:[rwx]”</div><div class="line"># setfacl -m m:r acl_test1</div><div class="line"># getfacl acl_test1</div><div class="line"># file: acl_test1</div><div class="line"># owner: root</div><div class="line"># group: root</div><div class="line">user::rw-</div><div class="line">user:test:r-x			#effective:r--</div><div class="line">group::r--</div><div class="line">mask::r--</div><div class="line">other::r--</div><div class="line"># test仅具有r的权限而已，并不存在x权限，这就是mask功能，我们可以通过mask来规定最大允许的权限</div></pre></td></tr></table></figure>
<h5 id="取得某个目录-文件的ACL设置项目-getfacl"><a href="#取得某个目录-文件的ACL设置项目-getfacl" class="headerlink" title="取得某个目录/文件的ACL设置项目:getfacl"></a>取得某个目录/文件的ACL设置项目:getfacl</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># getfacl filename</div><div class="line"></div><div class="line"># getfacl acl_test1</div><div class="line"># file: acl_test1   &lt;== 文件名</div><div class="line"># owner: root   &lt;== 文件所有者，即ll看到的第三用户字段</div><div class="line"># group: root   &lt;== 此文件所属用户组，即ll看到的第四用户字段</div><div class="line">user::rw-   &lt;== 用户列表栏空的，代表文件所有者的权限</div><div class="line">user:test:r-x   &lt;== 针对test的权限设置为rx，与所有者不同</div><div class="line">group::r--  &lt;== 文件用户组的权限设置仅为r</div><div class="line">mask::r-x   &lt;== 此文件默认的有效权限（mask）</div><div class="line">other::r--  &lt;== 其他人拥有的权限</div></pre></td></tr></table></figure>
<p>显示的数据前面加上#的，代表这个文件的默认属性，包括文件名，文件所有者与文件所属用户组。下面出现的user，group，mask，other则是属于不用用户，用户组与有效权限的设置值</p>
<h3 id="用户身份切换"><a href="#用户身份切换" class="headerlink" title="用户身份切换"></a>用户身份切换</h3><p>一般用户转变身份成为root：</p>
<ul>
<li>以“su -”直接将身份变成root即可，但是这个命令却需要root的密码，也就是说，如果你要以su变成root 的话，你的一般用户就必须要有root的密码才行</li>
<li>以“sudo命令”执行root的命令串，由于sudo需要事先设置妥当，且sudo需要输入用户自己的密码，因此多人共管同一台主机时，sudo要比su来的好，至少root密码不会流出去</li>
</ul>
<h4 id="su"><a href="#su" class="headerlink" title="su"></a>su</h4><p>su是最简单的身份切换命令了，它可以进行任何身份的切换<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># su [-lm] [-c 命令] [username]</div><div class="line">参数：</div><div class="line">- ：单纯使用 - 如“su -”，代表使用login-shell的变量文件读取方式来登录系统</div><div class="line">-l：与 - 类似，但后面需要加欲切换的用户账号。也是login-shell的方式</div><div class="line">-m：-m与-p是一样的，表示使用目前的环境设置，而不读取新用户的配置文件</div><div class="line">-c：仅进行一次命令，所以-c后面可以加上命令</div><div class="line"></div><div class="line">exit退出su环境</div></pre></td></tr></table></figure></p>
<p>单纯使用“su”切换成为root身份，读取的变量设置方式为non-login shell方式，这种方式下很多原本的变量不会被改变，还是原来用户的环境变量，如PATH</p>
<h4 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h4><p>sudo的执行仅需要自己的密码即可，甚至可以设置不需要密码也可执行！并非所有人都能够执行sudo，而是仅有/etc/sudoers内的用户才能够执行sudo这个命令，系统一开始默认仅有root可执行sudo<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># sudo [-b] [-u 新用户账号]</div><div class="line">参数：</div><div class="line">-b：将后续的命令让系统自动执行，而不与目前的shell产生影响</div><div class="line">-u：后面可以接欲切换的用户，若无此项则代表切换身份为root</div></pre></td></tr></table></figure></p>
<p>sudo的执行流程：</p>
<ol>
<li>当用户执行sudo时，系统于/etc/sudoers文件中查找该用户是否有执行sudo的权限</li>
<li>若用户具有可执行sudo的权限后，便让用户输入用户自己的密码来确认</li>
<li>若密码输入成功，便开始进行sudo后续接的命令（但root执行sudo时不需要输入密码）</li>
<li>若欲切换的身份与执行者的身份相同，那也不需要输入密码</li>
</ol>
<h5 id="visudo"><a href="#visudo" class="headerlink" title="visudo"></a>visudo</h5><p>除了root之外的其他账号，若想要使用sudo执行属于root的权限命令，则root需要先用visudo去修改/etc/sudoers，让账号能够使用全部或部分的root命令功能</p>
<h6 id="单一用户可进行root所有命令与sudoers文件语法"><a href="#单一用户可进行root所有命令与sudoers文件语法" class="headerlink" title="单一用户可进行root所有命令与sudoers文件语法"></a>单一用户可进行root所有命令与sudoers文件语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># 假设要让test这个账号可以使用root的任何命令</div><div class="line"># visudo</div><div class="line">...(前面省略)...</div><div class="line">root ALL=(ALL)   ALL &lt;==找到这一行，大约在76行左右</div><div class="line">test ALL=(ALL)   ALL &lt;==这一行是你要新增的</div><div class="line">...(后面省略)...</div></pre></td></tr></table></figure>
<p>其实visudo只是利用vi将/etc/sudoers文件调用出来进行修改而已，数据格式为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">用户账号  登录者的来源主机名=（可切换的身份） 可执行的命令</div><div class="line">root         ALL=(ALL)                       ALL &lt;==这是默认值</div></pre></td></tr></table></figure></p>
<p>4个参数的意义：</p>
<ul>
<li><code>用户账号</code>：系统的哪个账号可以使用sudo这个命令，默认为root这个账号</li>
<li><code>登录者的来源主机名</code>：这个账号由哪台主机连接到本Linux主机，意思是这个账号可能是由哪一台网络主机连接过来的，这个设置值可以指定客户端计算机（信任用户的意思）。默认值root可来自任何一台网络主机</li>
<li><code>可切换的身份</code>：这个账号可以切换成什么身份来执行后续的命令，默认root可以切换成任何人</li>
<li><code>可执行命令</code>：这个命令请务必使用绝对路径编写。默认root可以切换任何身份且进行任何命令    </li>
</ul>
<p><strong>注意：那个ALL是特殊关键字，代表任何身份，主机或命令的意思</strong></p>
<h6 id="利用用户组以及免密码的功能处理visudo"><a href="#利用用户组以及免密码的功能处理visudo" class="headerlink" title="利用用户组以及免密码的功能处理visudo"></a>利用用户组以及免密码的功能处理visudo</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># visudo</div><div class="line">...(前面省略)...</div><div class="line">%wheel   ALL=(ALL) ALL &lt;== 大约在84行左右，请将这行的#去掉</div><div class="line"># 在最左边加上%，代表后面接的是一个“用户组”之意</div><div class="line">...(后面省略)...</div><div class="line"></div><div class="line"># usermod -a -G wheel test &lt;== 将test加入wheel的支持，现在test用户就可以使用sudo命令啦</div></pre></td></tr></table></figure>
<h6 id="设置免密码即可使用sudo"><a href="#设置免密码即可使用sudo" class="headerlink" title="设置免密码即可使用sudo"></a>设置免密码即可使用sudo</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">...(前面省略)...</div><div class="line">%wheel   ALL=(ALL) NOPASSWD:ALL </div><div class="line"># 在最左边加上%，代表后面接的是一个“用户组”之意</div><div class="line">...(后面省略)...</div></pre></td></tr></table></figure>
<h6 id="有限制的命令操作"><a href="#有限制的命令操作" class="headerlink" title="有限制的命令操作"></a>有限制的命令操作</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># visudo </div><div class="line">myuser1 ALL=(root) /usr/bin/passwd &lt;== 最后命令务必用绝对路径</div></pre></td></tr></table></figure>
<h6 id="限制用户的命令参数"><a href="#限制用户的命令参数" class="headerlink" title="限制用户的命令参数"></a>限制用户的命令参数</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># visudo</div><div class="line">myuser1 ALL=(root) !/usr/bin/passwd, /usr/bin/passwd [A-Za-z]*, !/usr/bin/passwd root</div><div class="line"># 加上!代表“不可执行的意思”，因此上面这一行变成可以执行“passwd 任意字符”，但是“passwd”与“passwd root”这两个命令例外</div></pre></td></tr></table></figure>
<h6 id="通过别名设置visudo"><a href="#通过别名设置visudo" class="headerlink" title="通过别名设置visudo"></a>通过别名设置visudo</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># visudo</div><div class="line">User_Alias ADMPW = test1, test2, test3</div><div class="line">Cmnd_Alias ADMPWCOM = !/usr/bin/passwd, /usr/bin/passwd [A-Za-z]*, !/usr/bin/passwd root </div><div class="line">ADMPW ALL=(root) ADMPWCOM</div></pre></td></tr></table></figure>
<p>通过<code>User_Alias</code>新建一个新账号，新账号的名称一定要用大写字符来处理，包括<code>Cmnd_Alias（命令别名）</code>，<code>Host_Alias（来源主机名）</code>都需要使用大写字符</p>
<h6 id="sudo时间间隔"><a href="#sudo时间间隔" class="headerlink" title="sudo时间间隔"></a>sudo时间间隔</h6><p>如果两次sudo操作的间隔超过5分钟，那就得要重新输入一次你的密码了</p>
<h6 id="sudo搭配su的使用方式"><a href="#sudo搭配su的使用方式" class="headerlink" title="sudo搭配su的使用方式"></a>sudo搭配su的使用方式</h6><p>很多时候我们需要大量执行很多root的工作，所以一直使用sudo觉的很烦，那有没有办法使用sudo搭配su，一口气将身份转成root，而且还使用用户自己的密码来变成root呢？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># visudo </div><div class="line">User_Alias ADMINS = test1, test2, test3</div><div class="line">ADMINS ALL=(root) /bin/su -</div></pre></td></tr></table></figure></p>
<p>接下来，上述的test1，test2，test3三个用户，只要输入“sudo su -”并且输入自己的密码后，立刻变成root身份，不但root密码不会外泄，用户的管理也变的非常方便</p>
<h3 id="用户的特殊shell与PAM模块"><a href="#用户的特殊shell与PAM模块" class="headerlink" title="用户的特殊shell与PAM模块"></a>用户的特殊shell与PAM模块</h3><h4 id="特殊的shell，-sbin-nologin"><a href="#特殊的shell，-sbin-nologin" class="headerlink" title="特殊的shell，/sbin/nologin"></a>特殊的shell，/sbin/nologin</h4><p>一般地，系统账号是不能登录的，系统账号的shell就是使用/sbin/nologin，如果账户使用了/sbin/nologin，即使有了密码，也是不能登录系统的，但是可以使用系统资源</p>
<h4 id="PAM模块简介"><a href="#PAM模块简介" class="headerlink" title="PAM模块简介"></a>PAM模块简介</h4><p>PAM可以说是一套应用程序编程接口（Application Programming Interface API），它提供了一连串的验证机制，只要用户将验证阶段的需求告知PAM后，PAM就能够回报用户验证的结果（成功或失败）</p>
<p>PAM通过一个与程序相同文件名的配置文件来进行一连串的认证分析需求。我们同样以passwd这个命令调用PAM。当你执行passwd后，这个程序调用PAM的流程是：</p>
<ol>
<li>用户开始执行/usr/bin/passwd这支程序，并输入密码</li>
<li>passwd调用PAM模块进行验证</li>
<li>PAM模块会到/etc/pam.d/中找寻与程序（passwd）同名的配置文件</li>
<li>依据/etc/pam.d/passwd内的设置，引用相关的PAM模块逐步进行验证分析</li>
<li>将验证结果（成功，失败以及其他信息）回传给passwd这个程序</li>
<li>passwd这支程序会根据PAM回传的结果决定下一个操作（重新输入密码或者通过验证）</li>
</ol>
<h6 id="etc-pam-d-passwd"><a href="#etc-pam-d-passwd" class="headerlink" title="/etc/pam.d/passwd"></a>/etc/pam.d/passwd</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># cat /etc/pam.d/passwd</div><div class="line">#%PAM-1.0 </div><div class="line">auth include system-auth &lt;==每一行都是一个验证过程</div><div class="line">account include system-auth</div><div class="line">password include system-auth</div><div class="line">验证类型 控制标准 PAM模块与该模块参数</div></pre></td></tr></table></figure>
<h3 id="查询用户：w，who，last，lastlog"><a href="#查询用户：w，who，last，lastlog" class="headerlink" title="查询用户：w，who，last，lastlog"></a>查询用户：w，who，last，lastlog</h3><h4 id="查询目前已登录在系统上面的用户-w-或者-who"><a href="#查询目前已登录在系统上面的用户-w-或者-who" class="headerlink" title="查询目前已登录在系统上面的用户:w 或者 who"></a>查询目前已登录在系统上面的用户:w 或者 who</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># w</div><div class="line"> 17:36:26 up 26 days,  5:13,  1 user,  load average: 0.00, 0.00, 0.00</div><div class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</div><div class="line">root     pts/0    210.21.9.252     14:20    2.00s  0.03s  0.00s w</div><div class="line"># 第一行显示目前的时间，开机（up）多久，几个用户在系统上的平均负载等</div><div class="line"></div><div class="line"># who</div><div class="line">root     pts/0        2018-01-03 14:20 (210.21.9.252)</div></pre></td></tr></table></figure>
<h4 id="查看每个账号的最近登录时间，则可以使用lastlog这个命令。lastlog会去读取-var-log-lastlog文件，结果将数据输出"><a href="#查看每个账号的最近登录时间，则可以使用lastlog这个命令。lastlog会去读取-var-log-lastlog文件，结果将数据输出" class="headerlink" title="查看每个账号的最近登录时间，则可以使用lastlog这个命令。lastlog会去读取/var/log/lastlog文件，结果将数据输出"></a>查看每个账号的最近登录时间，则可以使用lastlog这个命令。lastlog会去读取/var/log/lastlog文件，结果将数据输出</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># lastlog</div><div class="line">Username         Port     From             Latest</div><div class="line">root             pts/0    210.21.9.252     Wed Jan  3 14:20:31 +0800 2018</div><div class="line">daemon                                     **Never logged in**</div><div class="line">bin                                        **Never logged in**</div><div class="line">sys                                        **Never logged in**</div><div class="line">sync                                       **Never logged in**</div><div class="line">games                                      **Never logged in**</div><div class="line">man                                        **Never logged in**</div></pre></td></tr></table></figure>
<h3 id="用户对谈：write，mesg，wall"><a href="#用户对谈：write，mesg，wall" class="headerlink" title="用户对谈：write，mesg，wall"></a>用户对谈：write，mesg，wall</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"># write 用户账号 [用户所在终端接口]</div><div class="line"></div><div class="line"># who</div><div class="line">root     pts/0        2018-01-03 14:20 (210.21.9.252)</div><div class="line">test     pts/1        2018-01-03 17:47 (210.21.9.252) &lt;== test用户在线</div><div class="line"></div><div class="line"># root向test发送消息</div><div class="line"># write test pts/1</div><div class="line">write: write: you have write permission turned off.</div><div class="line"></div><div class="line">fuck</div><div class="line"></div><div class="line"># test接收到的消息</div><div class="line">Message from root@iZwz9hwmk5t4idn4oxa4okZ on pts/0 at 17:49 ...</div><div class="line">fuck</div><div class="line">EOF</div><div class="line"></div><div class="line"># test不想接收任何信息，但是对于root传来的信息没有任何抵抗力</div><div class="line">mesg n</div><div class="line">$ mesg</div><div class="line">is n</div><div class="line"></div><div class="line"># 广播</div><div class="line"># wall &quot;this is a message&quot;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://clq2owesome.github.io/2018/02/25/Linux/Linux账号管理与ACL权限设置/" data-id="cjei97eak000989blwg9575y3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/02/25/Java/时间日期/Calendar/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Calendar
        
      </div>
    </a>
  
  
    <a href="/2018/02/25/服务器相关/redis/Redis集群/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Redis集群</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Eclipse/">Eclipse</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Github/">Github</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/Cookie/">Cookie</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/JAXB/">JAXB</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/JavaMail/">JavaMail</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/分布式/">分布式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/加密解密／编码解码/">加密解密／编码解码</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/基础/">基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/数据类型/">数据类型</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/日记/">日记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/时间日期/">时间日期</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/线程/">线程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/网络NIO/">网络NIO</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/队列/">队列</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/集合/">集合</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Maven/">Maven</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/Application-Event/">Application Event</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/JPA/">JPA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/Security/">Security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/Spring-Boot/">Spring Boot</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/Spring-Session/">Spring Session</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/Task/">Task</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/spring-MVC/">spring MVC</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/spring-data-redis/">spring data redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/基础/">基础</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端技术相关/">前端技术相关</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/前端技术相关/forever/">forever</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端技术相关/javascript/">javascript</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库相关/">数据库相关</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/数据库相关/mysql/">mysql</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/">服务器相关</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/Hessian/">Hessian</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/Hudson-Jenkins/">Hudson & Jenkins</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/Memcached/">Memcached</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/Nginx/">Nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/Tomcat/">Tomcat</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/red5/">red5</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/redis/">redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/resin/">resin</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/正则表达式/">正则表达式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络/">网络</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/03/08/正则表达式/正则表达式/">正则表达式</a>
          </li>
        
          <li>
            <a href="/2018/02/25/Java/基础/类加载机制/">类加载机制</a>
          </li>
        
          <li>
            <a href="/2018/02/25/Java/集合/HashSet原理/">HashSet原理</a>
          </li>
        
          <li>
            <a href="/2018/02/25/Java/集合/几种常见的map/">几种常见的map</a>
          </li>
        
          <li>
            <a href="/2018/02/25/Java/集合/Hashtable与ConcurrentHashMap区别/">Hashtable与ConcurrentHashMap区别</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 LeoChan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>