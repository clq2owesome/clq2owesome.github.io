<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>几个线程工具类 | LeoChan&#39;s 个人博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="CyclicBarrierCyclicBarrier 栅栏用于多个线程多次迭代时进行同步，在一轮任务中，任何线程完成任务后都在 barrier 上等待，直到所有其他线程也完成任务，然后一起释放，同时进入下一轮迭代。  CycliBarrier默认的构造方法CyclicBarrier(int parties)，参数标识屏障拦截的线程个数，每个线程调用await()方法告诉CyclicBarrier我">
<meta property="og:type" content="article">
<meta property="og:title" content="几个线程工具类">
<meta property="og:url" content="https://clq2owesome.github.io/2017/07/19/Java/线程/几个线程工具类/index.html">
<meta property="og:site_name" content="LeoChan&#39;s 个人博客">
<meta property="og:description" content="CyclicBarrierCyclicBarrier 栅栏用于多个线程多次迭代时进行同步，在一轮任务中，任何线程完成任务后都在 barrier 上等待，直到所有其他线程也完成任务，然后一起释放，同时进入下一轮迭代。  CycliBarrier默认的构造方法CyclicBarrier(int parties)，参数标识屏障拦截的线程个数，每个线程调用await()方法告诉CyclicBarrier我">
<meta property="og:updated_time" content="2017-07-26T06:53:04.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="几个线程工具类">
<meta name="twitter:description" content="CyclicBarrierCyclicBarrier 栅栏用于多个线程多次迭代时进行同步，在一轮任务中，任何线程完成任务后都在 barrier 上等待，直到所有其他线程也完成任务，然后一起释放，同时进入下一轮迭代。  CycliBarrier默认的构造方法CyclicBarrier(int parties)，参数标识屏障拦截的线程个数，每个线程调用await()方法告诉CyclicBarrier我">
  
    <link rel="alternate" href="/atom.xml" title="LeoChan&#39;s 个人博客" type="application/atom+xml">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" integrity="sha384-XdYbMnZ/QjLh6iI4ogqCTaIjrFk87ip+ekIjefZch0Y+PvJ8CDYtEs1ipDmPorQ+" crossorigin="anonymous">

  <link rel="stylesheet" href="/css/styles.css">
  

</head>

<body>
  <nav class="navbar navbar-inverse">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="main-menu-navbar">
      <ul class="nav navbar-nav">
        
          <li><a class=""
                 href="/index.html">Home</a></li>
        
          <li><a class=""
                 href="/archives/">Archives</a></li>
        
      </ul>

      <!--
      <ul class="nav navbar-nav navbar-right">
        
          <li><a href="/atom.xml" title="RSS Feed"><i class="fa fa-rss"></i></a></li>
        
      </ul>
      -->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

  <div class="container">
    <div class="blog-header">
  <h1 class="blog-title">LeoChan&#39;s 个人博客</h1>
  
    <p class="lead blog-description">技术都是通用的，重要的是是否具有自主解决问题的能力！</p>
  
</div>

    <div class="row">
        <div class="col-sm-8 blog-main">
          <article id="post-Java/线程/几个线程工具类" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 class="article-title" itemprop="name">
      几个线程工具类
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/07/19/Java/线程/几个线程工具类/" class="article-date"><time datetime="2017-07-19T02:09:45.000Z" itemprop="datePublished">2017-07-19</time></a>
</div>

    
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a> / <a class="article-category-link" href="/categories/Java/线程/">线程</a>
  </div>


  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h2><p>CyclicBarrier 栅栏用于多个线程多次迭代时进行同步，在一轮任务中，任何线程完成任务后都在 barrier 上等待，直到所有其他线程也完成任务，然后一起释放，同时进入下一轮迭代。</p>
<ul>
<li>CycliBarrier默认的构造方法CyclicBarrier(int parties)，参数标识屏障拦截的线程个数，每个线程调用<strong>await()</strong>方法告诉CyclicBarrier我们已经达到屏障了，然后当前线程被阻塞。当所有子线程都达到屏障后，则继续执行子线程的后续逻辑。</li>
<li>CyclicBarrier还提供了一个更高级的函数CyclicBarrier(int parties,Runnable barrierAction），用于在线程达到屏障时，优先执行barrierAction。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line">import java.util.concurrent.BrokenBarrierException;  </div><div class="line">import java.util.concurrent.CyclicBarrier;  </div><div class="line">  </div><div class="line">public class DemoOfBarrier &#123;  </div><div class="line">  </div><div class="line">    public static void main(String[] args) &#123;  </div><div class="line">  </div><div class="line">        final int numOfThread = 2;//线程数  </div><div class="line">        final int numOfIteration = 2;//迭代次数</div><div class="line">          </div><div class="line">        // 创建一个用于线程同步的 Barrier 对象  </div><div class="line">        final CyclicBarrier barrier = new CyclicBarrier(numOfThread,  </div><div class="line">                new Runnable() &#123;  </div><div class="line">  </div><div class="line">                    // 当所有线程到达 Barrier 后会执行这个任务  </div><div class="line">                    // 任务在第一个 到达 Barrier 的线程中执行  </div><div class="line">                    @Override  </div><div class="line">                    public void run() &#123;  </div><div class="line">                        long tid = Thread.currentThread().getId();  </div><div class="line">                        // 当所有线程完成一轮迭代之后做点清除/准备/提交工作  </div><div class="line">                        System.out.printf(&quot;[%d] - All threads arrived barrier...%n&quot;, tid);  </div><div class="line">                        try &#123;  </div><div class="line">                            Thread.sleep(2000);  </div><div class="line">                        &#125; catch (InterruptedException e) &#123;  </div><div class="line">                            e.printStackTrace();  </div><div class="line">                        &#125;  </div><div class="line">                        System.out.printf(&quot;[%d] - Clear work done...%n&quot;, tid);  </div><div class="line">                    &#125;  </div><div class="line">                      </div><div class="line">                &#125;);  </div><div class="line">  </div><div class="line">        // 创建并启动多个线程，他们在 Barrier 上同步  </div><div class="line">        for (int i = 0; i &lt; numOfThread; i++) &#123;  </div><div class="line">            Thread thread = new Thread(new Runnable() &#123;  </div><div class="line">  </div><div class="line">                @Override  </div><div class="line">                public void run() &#123;  </div><div class="line">                    long tid = Thread.currentThread().getId();  </div><div class="line">                    for ( int k=0; k&lt;numOfIteration; k++ ) &#123;  </div><div class="line">                        try &#123;  </div><div class="line">                            // 线程进行一轮迭代，做点事情  </div><div class="line">                            System.out.printf(&quot;Thread %d start its work...%n&quot;, tid);  </div><div class="line">                            long duration = (int)(Math.random()*5000);  </div><div class="line">                            Thread.sleep(duration);  </div><div class="line">                            // 做完迭代后等待其他线程完成迭代  </div><div class="line">                            System.out.printf(&quot;Thread %d wait on barrier...%n&quot;, tid);  </div><div class="line">                            int num = barrier.await();  </div><div class="line">                            // 显示完成的顺序  </div><div class="line">                            System.out.printf(&quot;Thread %d pass barrier with order=%d...%n&quot;, tid, num);  </div><div class="line">                        &#125; catch (InterruptedException e) &#123;  </div><div class="line">                            e.printStackTrace();  </div><div class="line">                            Thread.currentThread().interrupt();  </div><div class="line">                        &#125; catch (BrokenBarrierException e) &#123;  </div><div class="line">                            e.printStackTrace();  </div><div class="line">                        &#125;  </div><div class="line">                    &#125;  </div><div class="line">                &#125;  </div><div class="line">  </div><div class="line">            &#125;);  </div><div class="line">            thread.start();  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h2><p>CountDownLatch 闭锁：可以延迟线程的进度，直到锁到达终止状态。闭锁的作用相当于一扇门，在锁到达终止状态之前这扇门一直是关闭的。当锁到达终止状态时，允许所有线程通过。CountDownLatch 有一个初始值，通过调用 countDown 可以减少该值，一直到 0 时到达终止状态。</p>
<ul>
<li>CountDownLatch的构造函数接受一个int类型的参数作为计数器，调用countDwon()方法，计数器减1，await()方法阻塞当前线程，直到计数器变为0；</li>
<li>计数器为0的时候，调用awaite()方法不会阻塞主线程</li>
<li>初始化后，不能修改计数器的值</li>
<li>可以使用await(long time,TimeUnit unit)等待特定时间后，就不阻塞主线程<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">import java.util.concurrent.CountDownLatch;</div><div class="line">import java.util.concurrent.ExecutorService;</div><div class="line">import java.util.concurrent.Executors;</div><div class="line"></div><div class="line">/**</div><div class="line"> *</div><div class="line"> * CountDownLatch： </div><div class="line"> * 好比倒计时计数器，调用CountDownLatch对象的CountDown方法就将计数器减1，当计数器到达0时，则所有等待线程 </div><div class="line"> * 或单个等待线程开始执行。 </div><div class="line"> */ </div><div class="line">public class CountdownLatchTest &#123; </div><div class="line"> </div><div class="line">    public static void main(String[] args) &#123; </div><div class="line"> </div><div class="line">        ExecutorService service = Executors.newCachedThreadPool(); </div><div class="line">        // 创建两个计数器，cdOrder的初始值为1，cdAnswer初始值为3 </div><div class="line">        final CountDownLatch cdOrder = new CountDownLatch(1); </div><div class="line">        final CountDownLatch cdAnswer = new CountDownLatch(3);  </div><div class="line">    </div><div class="line">        for(int i=0;i&lt;3;i++)&#123; </div><div class="line">            Runnable runnable = new Runnable()&#123; </div><div class="line">                public void run()&#123; </div><div class="line">                    try &#123; </div><div class="line">                        System.out.println(&quot;线程&quot; + Thread.currentThread().getName() + &quot;正准备接受命令&quot;); </div><div class="line">                        cdOrder.await(); // 所有的线程都在此等待，并希望被其他线程调用cdOrder.countDown()激活，在这里由主线程激活 </div><div class="line">    </div><div class="line">                        System.out.println(&quot;线程&quot; + Thread.currentThread().getName() + &quot;已接受命令&quot;); </div><div class="line">                        Thread.sleep((long)(Math.random()*10000)); </div><div class="line">                        System.out.println(&quot;线程&quot; + Thread.currentThread().getName() + &quot;回应命令处理结果&quot;);  </div><div class="line">                        cdAnswer.countDown();// cdAnswer计数器的初始值为3，，三个线程到达后调用cdAnswer.countDown()到计数为0，激活主线程 </div><div class="line">                    &#125; catch (Exception e) &#123;</div><div class="line">                        e.printStackTrace(); </div><div class="line">                    &#125; </div><div class="line">                &#125; </div><div class="line">            &#125;; </div><div class="line">            service.execute(runnable); </div><div class="line">        &#125; </div><div class="line">    </div><div class="line">        try &#123; </div><div class="line">            Thread.sleep((long)(Math.random()*10000)); </div><div class="line">    </div><div class="line">            System.out.println(&quot;线程&quot; + Thread.currentThread().getName() + &quot;即将发布命令&quot;); </div><div class="line">            cdOrder.countDown();// 主线程将cdOrder计数器减1 </div><div class="line"> </div><div class="line">            System.out.println(&quot;线程&quot; + Thread.currentThread().getName() + &quot;已发送命令，正在等待结果&quot;); </div><div class="line">            cdAnswer.await();// 主线程正在等待，希望被其他线程激活 </div><div class="line">            </div><div class="line">            System.out.println(&quot;线程&quot; + Thread.currentThread().getName() + &quot;已收到所有响应结果&quot;); </div><div class="line">        &#125; catch (Exception e) &#123; </div><div class="line">            e.printStackTrace(); </div><div class="line">        &#125; </div><div class="line">        service.shutdown(); </div><div class="line">    &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line">import java.util.concurrent.CountDownLatch; </div><div class="line">import java.util.concurrent.atomic.AtomicInteger; </div><div class="line"> </div><div class="line">public class DemoOfLatch &#123; </div><div class="line"> </div><div class="line">    // 利用闭锁 CountDownLatch 控制主线程和子线程的同步 </div><div class="line">    public  static void main(String[] args) &#123; </div><div class="line">    </div><div class="line">        int numberOfThread = 5; </div><div class="line">        final CountDownLatch startLatch = new CountDownLatch(1); // 用于控制子线程开始 </div><div class="line">        final CountDownLatch stopLatch = new CountDownLatch(numberOfThread); // 用于子线程计数 </div><div class="line">        final AtomicInteger count = new AtomicInteger(0); // 用于分配子线程唯一标识 </div><div class="line"> </div><div class="line">        System.out.println(&quot;Main thread start...&quot;); </div><div class="line"> </div><div class="line">        for ( int i=0; i&lt;numberOfThread; i++ ) &#123; </div><div class="line">            Thread thread = new Thread( new Runnable() &#123; </div><div class="line"> </div><div class="line">                @Override </div><div class="line">                public void run() &#123; </div><div class="line">                    int tid = count.getAndIncrement(); </div><div class="line">                    try &#123; </div><div class="line">                        // 等代主线程打开启动信号 </div><div class="line">                        startLatch.await(); </div><div class="line">                        System.out.printf(&quot;Thread %d started...%n&quot;, tid); </div><div class="line">                        int duration = (int)(Math.random() * 000); </div><div class="line">                        Thread.sleep(duration); </div><div class="line">                    &#125; catch (InterruptedException e) &#123; </div><div class="line">                        e.printStackTrace(); </div><div class="line">                        Thread.currentThread().interrupt(); </div><div class="line">                    &#125; finally &#123; </div><div class="line">                        System.out.printf(&quot;Thread %d stoped...%n&quot;, tid); </div><div class="line">                        // 线程终止前减少线程计数 </div><div class="line">                        stopLatch.countDown(); </div><div class="line">                    &#125; </div><div class="line">                &#125; </div><div class="line">        </div><div class="line">            &#125;); </div><div class="line">            thread.start(); </div><div class="line">        &#125; </div><div class="line"> </div><div class="line">        // 在放行子线程之前做点什么别的事情 </div><div class="line">        System.out.println(&quot;Main thread do preparation work for child threads...&quot;); </div><div class="line">        try &#123; </div><div class="line">            Thread.sleep(2000); </div><div class="line">        &#125; catch (InterruptedException e) &#123; </div><div class="line">            e.printStackTrace(); </div><div class="line">        &#125; </div><div class="line"> </div><div class="line">        // 打开闭锁放行所有子线程 </div><div class="line">        System.out.println(&quot;Main thread let child threads go...&quot;); </div><div class="line">        startLatch.countDown(); </div><div class="line">    </div><div class="line">        try &#123; </div><div class="line">        // 等待子线程计数降为 0 即所有子线程执行完毕 </div><div class="line">        System.out.println(&quot;Main thread wait for all child threads...&quot;); </div><div class="line">            stopLatch.await(); </div><div class="line">        &#125; catch (InterruptedException e) &#123; </div><div class="line">            e.printStackTrace(); </div><div class="line">        &#125; </div><div class="line"> </div><div class="line">        System.out.println(&quot;Main thread exit...&quot;); </div><div class="line">    &#125; </div><div class="line"> </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="CyclicBarrier和CountDownLatch的区别"><a href="#CyclicBarrier和CountDownLatch的区别" class="headerlink" title="CyclicBarrier和CountDownLatch的区别"></a>CyclicBarrier和CountDownLatch的区别</h3><p>CountDownLatch的计数器只能使用一次，而CyclicBarrier的计数器可以使用reset()方法重置。所以CyclicBarrier能处理更为复杂的业务场景。例如，如果计算发生错误，可以重置计数器，并让线程重新执行一次。</p>
<p>CyclicBarrier还提供其他有用的方法，比如getNumberWaiting方法可以获得Cyclic-Barrier阻塞的线程数量。isBroken()方法用来了解阻塞的线程是否被中断。</p>
<h2 id="Exchanger"><a href="#Exchanger" class="headerlink" title="Exchanger"></a>Exchanger</h2><p>Exchanger可以在两个线程之间交换数据，只能是2个线程，他不支持更多的线程之间互换数据。<br>Exchanger（交换者）是一个用于线程间协作的工具类。Exchanger用于进行线程间的数据交换。它提供一个同步点，在这个同步点，两个线程可以交换彼此的数据。这两个线程通过exchange方法交换数据，如果第一个线程先执行exchange()方法，它会一直等待第二个线程也执行exchange方法，当两个线程都到达同步点时，这两个线程就可以交换数据，将本线程生产出来的数据传递给对方。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">public class ThreadLocalTest &#123;  </div><div class="line">  </div><div class="line">    public static void main(String[] args) &#123;  </div><div class="line">        Exchanger&lt;List&lt;Integer&gt;&gt; exchanger = new Exchanger&lt;&gt;();  </div><div class="line">        new Consumer(exchanger).start();  </div><div class="line">        new Producer(exchanger).start();  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line">class Producer extends Thread &#123;  </div><div class="line">    List&lt;Integer&gt; list = new ArrayList&lt;&gt;();  </div><div class="line">    Exchanger&lt;List&lt;Integer&gt;&gt; exchanger = null;  </div><div class="line">    public Producer(Exchanger&lt;List&lt;Integer&gt;&gt; exchanger) &#123;  </div><div class="line">        super();  </div><div class="line">        this.exchanger = exchanger;  </div><div class="line">    &#125;  </div><div class="line">    @Override  </div><div class="line">    public void run() &#123;  </div><div class="line">        Random rand = new Random();  </div><div class="line">        for(int i=0; i&lt;10; i++) &#123;  </div><div class="line">            list.clear();  </div><div class="line">            list.add(rand.nextInt(10000));  </div><div class="line">            list.add(rand.nextInt(10000));  </div><div class="line">            list.add(rand.nextInt(10000));  </div><div class="line">            list.add(rand.nextInt(10000));  </div><div class="line">            list.add(rand.nextInt(10000));  </div><div class="line">            try &#123;  </div><div class="line">                list = exchanger.exchange(list);  </div><div class="line">            &#125; catch (InterruptedException e) &#123;  </div><div class="line">                // TODO Auto-generated catch block  </div><div class="line">                e.printStackTrace();  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line">class Consumer extends Thread &#123;  </div><div class="line">    List&lt;Integer&gt; list = new ArrayList&lt;&gt;();  </div><div class="line">    Exchanger&lt;List&lt;Integer&gt;&gt; exchanger = null;  </div><div class="line">    public Consumer(Exchanger&lt;List&lt;Integer&gt;&gt; exchanger) &#123;  </div><div class="line">        super();  </div><div class="line">        this.exchanger = exchanger;  </div><div class="line">    &#125;  </div><div class="line">    @Override  </div><div class="line">    public void run() &#123;  </div><div class="line">        for(int i=0; i&lt;10; i++) &#123;  </div><div class="line">            try &#123;  </div><div class="line">                list = exchanger.exchange(list);  </div><div class="line">            &#125; catch (InterruptedException e) &#123;  </div><div class="line">                // TODO Auto-generated catch block  </div><div class="line">                e.printStackTrace();  </div><div class="line">            &#125;  </div><div class="line">            System.out.print(list.get(0)+&quot;, &quot;);  </div><div class="line">            System.out.print(list.get(1)+&quot;, &quot;);  </div><div class="line">            System.out.print(list.get(2)+&quot;, &quot;);  </div><div class="line">            System.out.print(list.get(3)+&quot;, &quot;);  </div><div class="line">            System.out.println(list.get(4)+&quot;, &quot;);  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="FutureTask"><a href="#FutureTask" class="headerlink" title="FutureTask"></a>FutureTask</h2><p>FutureTask 用于执行一个可返回结果的长任务，任务在单独的线程中执行，其他线程可以用 get 方法取任务结果，如果任务尚未完成，线程在 get 上阻塞。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">import java.util.concurrent.Callable; </div><div class="line">import java.util.concurrent.ExecutionException; </div><div class="line">import java.util.concurrent.FutureTask; </div><div class="line"> </div><div class="line"> </div><div class="line">public class DemoOfFutureTask &#123; </div><div class="line"> </div><div class="line">    public static void main(String[] args) &#123; </div><div class="line">    </div><div class="line">        // 创建一个 Future Task 用于并发执行长任务 </div><div class="line">        final FutureTask&lt;Movie&gt; future = new FutureTask&lt;Movie&gt;( new Callable&lt;Movie&gt;() &#123; </div><div class="line"> </div><div class="line">            @Override </div><div class="line">            public Movie call() throws Exception &#123; </div><div class="line">                System.out.println(&quot;Future task started...&quot;); </div><div class="line">                Thread.sleep(5000); </div><div class="line">                System.out.println(&quot;Future task finished...&quot;); </div><div class="line">                return new Movie(&quot;2012&quot;,&quot;Unknown&quot;); </div><div class="line">            &#125; </div><div class="line">    </div><div class="line">        &#125;); </div><div class="line">    </div><div class="line">        // 在子线程中启动任务 </div><div class="line">        Thread thread = new Thread(future); </div><div class="line">        thread.start(); </div><div class="line"> </div><div class="line">        // 主线程干点别的事情 </div><div class="line">        System.out.println(&quot;Now let&apos;s do sth eles...&quot;); </div><div class="line">        try &#123; </div><div class="line">            Thread.sleep(1000); </div><div class="line">        &#125; catch (InterruptedException e1) &#123; </div><div class="line">            e1.printStackTrace(); </div><div class="line">        &#125; </div><div class="line">    </div><div class="line">        // 主线程开始取结果 </div><div class="line">        System.out.println(&quot;Now wait for result of future task...&quot;); </div><div class="line">        try &#123; </div><div class="line">            Movie res = future.get(); </div><div class="line">            System.out.printf(&quot;Result from task is name=%s, actor=%s&quot;, res.name, res.actor); </div><div class="line">        &#125; catch (InterruptedException e) &#123; </div><div class="line">            e.printStackTrace(); </div><div class="line">        &#125; catch (ExecutionException e) &#123; </div><div class="line">            e.printStackTrace(); </div><div class="line">        &#125; </div><div class="line"> </div><div class="line">    &#125; </div><div class="line">    </div><div class="line">    public static class Movie &#123; </div><div class="line">        final public String name; </div><div class="line">        final public String actor; </div><div class="line">        public Movie(String name, String actor) &#123; </div><div class="line">            this.name = name; </div><div class="line">            this.actor = actor; </div><div class="line">        &#125; </div><div class="line">    &#125; </div><div class="line"> </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h2><p>Semaphore 用于控制同时访问某资源，或同时执行某操作的线程数目。信号量有一个初始值即可以分配的信号量总数目。线程任务开始前先调用 acquire 取得信号量，任务结束后调用 release 释放信号量。在 acquire 是如果没有可用信号量，线程将阻塞在 acquire 上，直到其他线程释放一个信号量。</p>
<ul>
<li>Semaphore的构造方法Semaphore(int permits)，permits标识许可证数量。执行任务前，acquire()方法获取一个许可证；任务执行完成后调用relese()方法归还许可证。没有获得许可证的子线程就阻塞等待。</li>
<li>tryAcquire()：尝试获取许可证； </li>
<li>intavaliablePermits()：返回信号量中当前许可证的个数； </li>
<li>intgetQueueLength()：返回正在等待获取许可证的线程个数； </li>
<li>booleanhasQueueThreads()：是否有线程正在等待许可证； </li>
<li>reducePermits(int reduction)：减少reduction个许可证； </li>
<li>getQueuedThreads()：返回所有等待获取许可证的线程集合； <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">import java.util.concurrent.Semaphore;  </div><div class="line">import java.util.concurrent.atomic.AtomicInteger;  </div><div class="line">  </div><div class="line">public class DemoOfSemaphore &#123;  </div><div class="line">  </div><div class="line">    /** </div><div class="line">     * @param args </div><div class="line">     */  </div><div class="line">    public static void main(String[] args) &#123;  </div><div class="line">  </div><div class="line">        final int numOfThread = 5;  </div><div class="line">        final AtomicInteger count = new AtomicInteger(0);       // 用于分配唯一线程标识  </div><div class="line">        final Semaphore semaphore = new Semaphore(numOfThread); // 用于控制并发线程数目  </div><div class="line">  </div><div class="line">        for (int i = 0; i &lt; 10; i++) &#123;  </div><div class="line">            Thread thread = new Thread(new Runnable() &#123;  </div><div class="line">  </div><div class="line">                @Override  </div><div class="line">                public void run() &#123;  </div><div class="line">                    int tid = count.getAndIncrement();  </div><div class="line">                    try &#123;  </div><div class="line">                        // 等待直到取得信号量  </div><div class="line">                        System.out.printf(&quot;Thread %d wait on semaphore...%n&quot;, tid);  </div><div class="line">                        semaphore.acquire();  </div><div class="line">                        // 取得信号量之后做点事情  </div><div class="line">                        System.out.printf(&quot;Thread %d get semaphore...%n&quot;, tid);  </div><div class="line">                        int duration = (int)(Math.random() * 5000);  </div><div class="line">                        Thread.sleep(duration);  </div><div class="line">                    &#125; catch (InterruptedException e) &#123;  </div><div class="line">                        e.printStackTrace();  </div><div class="line">                    &#125; finally &#123;  </div><div class="line">                        // 做完后释放信号量  </div><div class="line">                        System.out.printf(&quot;Thread %d release semaphore...%n&quot;, tid);  </div><div class="line">                        semaphore.release();  </div><div class="line">                    &#125;  </div><div class="line">                      </div><div class="line">                &#125;  </div><div class="line">                  </div><div class="line">            &#125;);  </div><div class="line">            thread.start();  </div><div class="line">        &#125;  </div><div class="line">          </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://clq2owesome.github.io/2017/07/19/Java/线程/几个线程工具类/" data-id="cj6cy7nge0050ktblpyl3uquv" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      

    </footer>
  </div>
  
    
<ul id="article-nav" class="nav nav-pills nav-justified">
  
  <li role="presentation">
    <a href="/2017/07/19/Java/线程/线程常用的方法/" id="article-nav-older" class="article-nav-link-wrap">
      <i class="fa fa-chevron-left pull-left"></i>
      <span class="article-nav-link-title">线程常用的方法</span>
    </a>
  </li>
  
  
  <li role="presentation">
    <a href="/2017/07/19/Java/线程/本地线程ThreadLocal/" id="article-nav-newer" class="article-nav-link-wrap">
      <span class="article-nav-link-title">本地线程ThreadLocal</span>
      <i class="fa fa-chevron-right pull-right"></i>
    </a>
  </li>
  
</ul>


  
</article>




        </div>
        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
          
  <div class="sidebar-module sidebar-module-inset">
  <h4>关于</h4>
  <p>该博客内的文章是博主在日常工作或者学习中总结出来，部分内容来自网络.</p>

</div>


  
  <div class="sidebar-module">
    <h4>分类</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Eclipse/">Eclipse</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Github/">Github</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Java/">Java</a><span class="sidebar-module-list-count">60</span><ul class="sidebar-module-list-child"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Java/Cookie/">Cookie</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Java/JAXB/">JAXB</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Java/JavaMail/">JavaMail</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Java/加密解密／编码解码/">加密解密／编码解码</a><span class="sidebar-module-list-count">7</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Java/基础/">基础</a><span class="sidebar-module-list-count">8</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Java/数据类型/">数据类型</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Java/日记/">日记</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Java/线程/">线程</a><span class="sidebar-module-list-count">16</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Java/网络NIO/">网络NIO</a><span class="sidebar-module-list-count">12</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Java/队列/">队列</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Java/集合/">集合</a><span class="sidebar-module-list-count">3</span></li></ul></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Linux/">Linux</a><span class="sidebar-module-list-count">7</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Maven/">Maven</a><span class="sidebar-module-list-count">9</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Spring/">Spring</a><span class="sidebar-module-list-count">56</span><ul class="sidebar-module-list-child"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Spring/Application-Event/">Application Event</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Spring/JPA/">JPA</a><span class="sidebar-module-list-count">7</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Spring/Security/">Security</a><span class="sidebar-module-list-count">22</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Spring/Task/">Task</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Spring/spring-MVC/">spring MVC</a><span class="sidebar-module-list-count">17</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Spring/spring-data-redis/">spring data redis</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Spring/基础/">基础</a><span class="sidebar-module-list-count">5</span></li></ul></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/前端技术相关/">前端技术相关</a><span class="sidebar-module-list-count">3</span><ul class="sidebar-module-list-child"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/前端技术相关/forever/">forever</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/前端技术相关/javascript/">javascript</a><span class="sidebar-module-list-count">1</span></li></ul></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/数据库相关/">数据库相关</a><span class="sidebar-module-list-count">11</span><ul class="sidebar-module-list-child"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/数据库相关/mysql/">mysql</a><span class="sidebar-module-list-count">11</span></li></ul></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/服务器相关/">服务器相关</a><span class="sidebar-module-list-count">22</span><ul class="sidebar-module-list-child"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/服务器相关/Hessian/">Hessian</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/服务器相关/Hudson-Jenkins/">Hudson & Jenkins</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/服务器相关/Memcached/">Memcached</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/服务器相关/Tomcat/">Tomcat</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/服务器相关/red5/">red5</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/服务器相关/redis/">redis</a><span class="sidebar-module-list-count">9</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/服务器相关/resin/">resin</a><span class="sidebar-module-list-count">3</span></li></ul></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/网络/">网络</a><span class="sidebar-module-list-count">7</span></li></ul>
  </div>



  


  

  
  <div class="sidebar-module">
    <h4>归档</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/08/">八月 2017</a><span class="sidebar-module-list-count">53</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/07/">七月 2017</a><span class="sidebar-module-list-count">124</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>最近文章</h4>
    <ul class="sidebar-module-list">
      
        <li>
          <a href="/2017/08/15/Spring/Security/配置十三：session管理/">配置十三：session管理</a>
        </li>
      
        <li>
          <a href="/2017/08/15/Spring/Security/配置七：缓存UserDetails/">配置七：缓存UserDetails</a>
        </li>
      
        <li>
          <a href="/2017/08/15/Spring/Security/配置四：认证过程/">配置四：认证过程</a>
        </li>
      
        <li>
          <a href="/2017/08/15/Spring/Security/配置十：退出登录/">配置十：退出登录</a>
        </li>
      
        <li>
          <a href="/2017/08/15/Spring/Security/配置十六：基于表达式的权限控制/">配置十六：基于表达式的权限控制</a>
        </li>
      
    </ul>
  </div>



        </div>
    </div>
  </div>
  <footer class="blog-footer">
  <div class="container">
    <div id="footer-info" class="inner">
      &copy; 2017 LeoChan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

  

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>



<script src="/js/script.js"></script>

</body>
</html>
