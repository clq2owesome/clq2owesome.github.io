<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="description" content="描述啊">
  <meta name="keywords" content="undefined">
  
    <link rel="icon" href="">
  
    
  <title>memcached命令 | LeoChan&#39;s 个人博客</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.css" />
</head>

<body>
  <header>
  <div class="header-container">
    <a class='logo' href="/">
      <span>LeoChan's 个人博客</span>
    </a>
    <ul class="right-header">
      
        <li class="nav-item">
          
            <a href="/" class="item-link">首页</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/about" class="item-link">关于</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/archives" class="item-link">归档</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/tags" class="item-link">标签</a>
          
        </li>
      
    </ul>
  </div>
</header>

  <main id='post'>
  <div class="content">
    <article>
        <section class="content markdown-body">
          <h1>memcached命令</h1>
          <div class='post-meta'>
            <i class="fa fa-calendar" aria-hidden="true"></i> <time>2017年08月12日</time>
            
              | <i class="fa fa-folder-open-o" aria-hidden="true"></i> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/服务器相关/">服务器相关</a>/ <a class="article-category-link" href="/categories/服务器相关/Memcached/">Memcached</a>
  </div>



            
            
          </div>
          <h4 id="启动Memcached"><a href="#启动Memcached" class="headerlink" title="启动Memcached"></a>启动Memcached</h4><p>一般情况下，简单地可以使用类似如下形式，启动Memcached服务：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/bin/memcached -d -m 64 -I 20m -u root -l 192.168.4.86 -p 11211 -c 1024 -P /usr/local/memcached/memcached.pid</div></pre></td></tr></table></figure></p>
<p>上述命令行中，基于上面各个选项，以及其他一些选项的含义，说明如下表所示：</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-d</td>
<td>指定memcached进程作为一个守护进程启动</td>
</tr>
<tr>
<td>-m <num></num></td>
<td>指定分配给memcached使用的内存，单位是MB</td>
</tr>
<tr>
<td>-u <username></username></td>
<td>运行memcached的用户</td>
</tr>
<tr>
<td>-l <ip_addr></ip_addr></td>
<td>监听的服务器IP地址，如果有多个地址的话，使用逗号分隔，格式可以为“IP地址:端口号”，例如：-l 指定192.168.0.184:19830,192.168.0.195:13542；端口号也可以通过-p选项指定</td>
</tr>
<tr>
<td>-p <num></num></td>
<td>Memcached监听的端口，要保证该端口号未被占用</td>
</tr>
<tr>
<td>-c <num></num></td>
<td>设置最大运行的并发连接数，默认是1024</td>
</tr>
<tr>
<td>-R <num></num></td>
<td>为避免客户端饿死（starvation），对连续达到的客户端请求数设置一个限额，如果超过该设置，会选择另一个连接来处理请求，默认为20</td>
</tr>
<tr>
<td>-k</td>
<td>设置锁定所有分页的内存，对于大缓存应用场景，谨慎使用该选项</td>
</tr>
<tr>
<td>-P</td>
<td>保存memcached进程的pid文件</td>
</tr>
<tr>
<td>-s <file></file></td>
<td>指定Memcached用于监听的UNIX socket文件</td>
</tr>
<tr>
<td>-a <perms></perms></td>
<td>设置-s选项指定的UNIX socket文件的权限</td>
</tr>
<tr>
<td>-U <num></num></td>
<td>指定监听UDP的端口，默认11211，0表示关闭</td>
</tr>
<tr>
<td>-M</td>
<td>当内存使用超出配置值时，禁止自动清除缓存中的数据项，此时Memcached不可以，直到内存被释放</td>
</tr>
<tr>
<td>-r</td>
<td>设置产生core文件大小</td>
</tr>
<tr>
<td>-f <factor></factor></td>
<td>用于计算缓存数据项的内存块大小的乘数因子，默认是1.25</td>
</tr>
<tr>
<td>-n</td>
<td>为缓存数据项的key、value、flag设置最小分配字节数，默认是48</td>
</tr>
<tr>
<td>-C</td>
<td>禁用CAS</td>
</tr>
<tr>
<td>-h</td>
<td>显示Memcached版本和摘要信息</td>
</tr>
<tr>
<td>-v</td>
<td>输出警告和错误信息</td>
</tr>
<tr>
<td>-vv</td>
<td>打印信息比-v更详细：不仅输出警告和错误信息，也输出客户端请求和响应信息</td>
</tr>
<tr>
<td>-i</td>
<td>打印libevent和Memcached的licenses信息</td>
</tr>
<tr>
<td>-t <threads></threads></td>
<td>指定用来处理请求的线程数，默认为4</td>
</tr>
<tr>
<td>-D <char></char></td>
<td>用于统计报告中Key前缀和ID之间的分隔符，默认是冒号“:”</td>
</tr>
<tr>
<td>-L</td>
<td>尝试使用大内存分页（pages）</td>
</tr>
<tr>
<td>-B <proto></proto></td>
<td>指定使用的协议，默认行为是自动协商（autonegotiate），可能使用的选项有auto、ascii、binary。</td>
</tr>
<tr>
<td>-I <size></size></td>
<td>覆盖默认的STAB页大小，默认是1M</td>
</tr>
<tr>
<td>-F</td>
<td>禁用flush_all命令</td>
</tr>
<tr>
<td>-o <options></options></td>
<td>指定逗号分隔的选项，一般用于用于扩展或实验性质的选项</td>
</tr>
</tbody>
</table>
<h3 id="停止Memcached"><a href="#停止Memcached" class="headerlink" title="停止Memcached"></a>停止Memcached</h3><p>可以通过Linux的如下命令查询到Memcached的进程号：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -ef | grep memcached</div></pre></td></tr></table></figure></p>
<p>然后杀掉Memcached服务进程：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kill -9 &lt;PID&gt;</div></pre></td></tr></table></figure></p>
<p>-9表示强制杀掉进程。</p>
<h4 id="Telnet客户端"><a href="#Telnet客户端" class="headerlink" title="Telnet客户端"></a>Telnet客户端</h4><p>Telnet客户端可以通过命令行的方式来监控查看Memcached服务器存储数据的情况。例如，Memcached的服务地址为192.168.4.86:11211，可以telnet到该服务端口：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">telnet 192.168.4.86 11211</div></pre></td></tr></table></figure></p>
<p>如果连接成功，可以使用如下一些命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">stats命令</div></pre></td></tr></table></figure></p>
<p>该命令用于显示服务器信息、统计数据等，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">STAT pid 22362   //memcache服务器的进程ID</div><div class="line">STAT uptime 1469315  //服务器已经运行的秒数</div><div class="line">STAT time 1339671194   //服务器当前的unix时间戳</div><div class="line">STAT version 1.4.9   //memcache版本</div><div class="line">STAT libevent 1.4.9-stable  //libevent版本</div><div class="line">STAT pointer_size 64   //当前操作系统的指针大小（32位系统一般是32bit,64就是64位操作系统）</div><div class="line">STAT rusage_user 3695.485200     //进程的累计用户时间</div><div class="line">STAT rusage_system 14751.273465  //进程的累计系统时间</div><div class="line">STAT curr_connections 69     //服务器当前存储的items数量</div><div class="line">STAT total_connections 855430    //从服务器启动以后存储的items总数量</div><div class="line">STAT connection_structures 74    //服务器分配的连接构造数</div><div class="line">STAT reserved_fds 20</div><div class="line">STAT cmd_get 328806688   //get命令（获取）总请求次数</div><div class="line">STAT cmd_set 75441133    //set命令（保存）总请求次数</div><div class="line">STAT cmd_flush 34    //flush命令请求次数</div><div class="line">STAT cmd_touch 0     //touch命令请求次数</div><div class="line">STAT get_hits 253547177  //总命中次数</div><div class="line">STAT get_misses 75259511     //总未命中次数</div><div class="line">STAT delete_misses 4     //delete命令未命中次数</div><div class="line">STAT delete_hits 565730  //delete命令命中次数</div><div class="line">STAT incr_misses 0 //incr命令未命中次数</div><div class="line">STAT incr_hits 0 //incr命令命中次数</div><div class="line">STAT decr_misses 0  //decr命令未命中次数</div><div class="line">STAT decr_hits 0  //decr命令命中次数</div><div class="line">STAT cas_misses 0  //cas命令未命中次数</div><div class="line">STAT cas_hits 0  //cas命令命中次数</div><div class="line">STAT cas_badval 0    //使用擦拭次数</div><div class="line">STAT touch_hits 0    //touch命令未命中次数</div><div class="line">STAT touch_misses 0  //touch命令命中次数</div><div class="line">STAT auth_cmds 0     //认证命令处理的次数</div><div class="line">STAT auth_errors 0   //认证失败数目</div><div class="line">STAT bytes_read 545701515844     //总读取字节数（请求字节数）</div><div class="line">STAT bytes_written 1649639749866     //总发送字节数（结果字节数）</div><div class="line">STAT limit_maxbytes 2147483648   //分配给memcache的内存大小（字节）</div><div class="line">STAT accepting_conns 1   //服务器是否达到过最大连接（0/1）</div><div class="line">STAT listen_disabled_num 0   //失效的监听数</div><div class="line">STAT threads 4   //当前线程数</div><div class="line">STAT conn_yields 14  //连接操作主动放弃数目</div><div class="line">STAT hash_power_level 16   </div><div class="line">STAT hash_bytes 524288</div><div class="line">STAT hash_is_expanding 0</div><div class="line">STAT expired_unfetched 30705763</div><div class="line">STAT evicted_unfetched 0</div><div class="line">STAT bytes 61380700  //当前存储占用的字节数</div><div class="line">STAT curr_items 28786    //当前存储的数据总数</div><div class="line">STAT total_items 75441133    //启动以来存储的数据总数</div><div class="line">STAT evictions 0     //为获取空闲内存而删除的items数（分配给memcache的空间用满后需要删除旧的items来得到空间分配给新的items)</div><div class="line">STAT reclaimed 39957976  //已过期的数据条目来存储新数据的数目</div><div class="line">END</div></pre></td></tr></table></figure></p>
<p>stats命令有几个二级子项，说明如下表所示：   </p>
<table>
<thead>
<tr>
<th>命令</th>
<th>含义说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>stats slabs</td>
<td>显示各个slab的信息，包括chunk的大小、数目、使用情况等</td>
</tr>
<tr>
<td>stats items</td>
<td>显示各个slab中item的数目和最老item的年龄（最后一次访问距离现在的秒数）</td>
</tr>
<tr>
<td>stats detail [on\</td>
<td>off\</td>
<td>dump]</td>
<td>设置或者显示详细操作记录；<br>参数为on，打开详细操作记录；<br>参数为off，关闭详细操作记录；<br>参数为dump，显示详细操作记录（每一个键值get、set、hit、del的次数）</td>
</tr>
<tr>
<td>stats malloc</td>
<td>打印内存分配信息</td>
</tr>
<tr>
<td>stats sizes</td>
<td>打印缓存使用信息</td>
</tr>
<tr>
<td>stats reset</td>
<td>重置统计信息</td>
</tr>
</tbody>
</table>
<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><table>
<thead>
<tr>
<th>命令</th>
<th>用法格式</th>
<th>含义说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>get</td>
<td>get <key></key></td>
<td>用于获取缓存的数据，键为key。</td>
</tr>
<tr>
<td>gets</td>
<td>gets <key></key></td>
<td>用于获取缓存的数据，键为一组key。</td>
</tr>
<tr>
<td>set</td>
<td>set <key> <flags> <exptime> <bytes> [noreply] <value></value></bytes></exptime></flags></key></td>
<td>向缓存中存储数据，不管key对应的值存在与否，都设置key对应的值</td>
</tr>
<tr>
<td>touch</td>
<td>touch <key> <exptime> [noreply]</exptime></key></td>
<td>更新缓存中key对应的值的过期时间。</td>
</tr>
<tr>
<td>delete</td>
<td>delete <key> [<time>] [noreply]</time></key></td>
<td>给定键key，删除缓存中key对应的数据。</td>
</tr>
<tr>
<td>add</td>
<td>add <key> <flags> <exptime> <bytes> [noreply] <value></value></bytes></exptime></flags></key></td>
<td>向缓存中存储数据，只有key对应的值不存在时，才会设置key对应的值。</td>
</tr>
<tr>
<td>replace</td>
<td>replace <key> <flags> <exptime> <bytes> [noreply] <value></value></bytes></exptime></flags></key></td>
<td>覆盖一个已经存在Key及其对应的Value，替换一定要保证替换后的值的长度原始长度相同，否则replace失败。</td>
</tr>
<tr>
<td>append</td>
<td>append <key> <flags> <exptime> <bytes> [noreply] <value></value></bytes></exptime></flags></key></td>
<td>在一个已经存在的数据值（value）上追加，是在数据值的后面追加。</td>
</tr>
<tr>
<td>prepend</td>
<td>prepend <key> <flags> <exptime> <bytes> [noreply] <value></value></bytes></exptime></flags></key></td>
<td>在一个已经存在的数据值（value）上追加，是在数据值的前面追加。</td>
</tr>
<tr>
<td>incr</td>
<td>incr <key> <value> [noreply]</value></key></td>
<td>计数命令，可以在原来已经存在的数字上进行累加求和，计算并存储新的数值。</td>
</tr>
<tr>
<td>decr</td>
<td>decr <key> <value> [noreply]</value></key></td>
<td>计数命令，可以在原来已经存在的数字上进行减法计算，计算并存储新的数值。</td>
</tr>
<tr>
<td>flush_all</td>
<td>flush_all [<time>] [noreply]</time></td>
<td>使缓存中的数据项失效，可选参数是在多少秒后失效。</td>
</tr>
<tr>
<td>version</td>
<td>version</td>
<td>返回Memcached服务器的版本信息。</td>
</tr>
<tr>
<td>quit</td>
<td>quit</td>
<td>退出telnet终端。</td>
</tr>
</tbody>
</table>

        </section>
    </article>
    
        
  </div>
  <aside>
    
    <div class="toc-container">
        <h1>目录</h1>
        <div class="content">
            <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#启动Memcached"><span class="toc-number">1.</span> <span class="toc-text">启动Memcached</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#停止Memcached"><span class="toc-number"></span> <span class="toc-text">停止Memcached</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Telnet客户端"><span class="toc-number">1.</span> <span class="toc-text">Telnet客户端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#常用命令"><span class="toc-number">2.</span> <span class="toc-text">常用命令</span></a></li></ol>
        </div>
    </div>
    
  </aside>
</main>



  <footer>
  <div class="copyright">
    <div>
      &copy; 2018 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a>&nbsp
    </div>
    <div>
      Theme by <a href="https://github.com/lewis-geek/hexo-theme-Aath" target="_blank">Aath</a>
    </div>
  </div>
</footer>


<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="/lib/in-view.min.js"></script>
<script src="/lib/lodash.min.js"></script>
<script>
  var isDown = true
  var oldY = 0
  inView.offset(50)

  document.body.addEventListener('touchstart', function(){});
  
  window.addEventListener('scroll', _.throttle(e => {
    var currentY = window.scrollY
    if((oldY - currentY) < 0) {
      isDown = true
    } else {
      isDown = false
    }
    oldY = currentY
  }, 250))

  $("article img").each(function() {
      var strA = "<a data-fancybox='gallery' href='" + this.src + "'></a>";
      $(this).wrapAll(strA);
  });

  $('.toc-link').each(function() {
      var href = $(this).attr("href");
      
      inView(href).on('exit', () => {
        if (isDown) {
          handleActive(href)
        }
      })

      inView(href).on('enter', () => {
        if (!isDown) {
          handleActive(href)
        }
      })

      this.onclick = function(e) {
        var pos = $(href).offset().top - 10;
        $("html,body").animate({scrollTop: pos}, 300);
        setTimeout(() => {
          handleActive(href)
        }, 350)
        return false
      }
  })

  function handleActive(href) {
    document.querySelectorAll('.toc-link').forEach(elm => {
      elm.classList.remove('active')
    })
    document.querySelector(".toc [href='"+ href +"']").classList.add('active')
  }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.js"></script>


</body>
</html>
