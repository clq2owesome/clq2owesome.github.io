<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>实践运用整合 | LeoChan&#39;s 个人博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="添加相应的jar包1234567891011121314151617&amp;lt;!-- spring security start  --&amp;gt;&amp;lt;dependency&amp;gt;    &amp;lt;groupId&amp;gt;org.springframework.security&amp;lt;/groupId&amp;gt;    &amp;lt;artifactId&amp;gt;spring-security-config&amp;lt;">
<meta property="og:type" content="article">
<meta property="og:title" content="实践运用整合">
<meta property="og:url" content="https://clq2owesome.github.io/2017/08/15/Spring/Security/实践运用整合/index.html">
<meta property="og:site_name" content="LeoChan&#39;s 个人博客">
<meta property="og:description" content="添加相应的jar包1234567891011121314151617&amp;lt;!-- spring security start  --&amp;gt;&amp;lt;dependency&amp;gt;    &amp;lt;groupId&amp;gt;org.springframework.security&amp;lt;/groupId&amp;gt;    &amp;lt;artifactId&amp;gt;spring-security-config&amp;lt;">
<meta property="og:updated_time" content="2017-08-15T02:07:21.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="实践运用整合">
<meta name="twitter:description" content="添加相应的jar包1234567891011121314151617&amp;lt;!-- spring security start  --&amp;gt;&amp;lt;dependency&amp;gt;    &amp;lt;groupId&amp;gt;org.springframework.security&amp;lt;/groupId&amp;gt;    &amp;lt;artifactId&amp;gt;spring-security-config&amp;lt;">
  
    <link rel="alternate" href="/atom.xml" title="LeoChan&#39;s 个人博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">LeoChan&#39;s 个人博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">技术都是通用的，重要的是是否具有自主解决问题的能力！</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://clq2owesome.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Spring/Security/实践运用整合" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/15/Spring/Security/实践运用整合/" class="article-date">
  <time datetime="2017-08-15T02:09:45.000Z" itemprop="datePublished">2017-08-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Spring/">Spring</a>►<a class="article-category-link" href="/categories/Spring/Security/">Security</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      实践运用整合
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="添加相应的jar包"><a href="#添加相应的jar包" class="headerlink" title="添加相应的jar包"></a>添加相应的jar包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;!-- spring security start  --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-security-config&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;4.0.3.RELEASE&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-security-core&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;4.0.3.RELEASE&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-security-web&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;4.0.3.RELEASE&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">&lt;!-- spring security end  --&gt;</div></pre></td></tr></table></figure>
<h2 id="web-xml中添加相应过滤器"><a href="#web-xml中添加相应过滤器" class="headerlink" title="web.xml中添加相应过滤器"></a>web.xml中添加相应过滤器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;!-- Spring security过滤器，需要注意的是该filter一定要定义在其它如SpringMVC等拦截请求之前 --&gt;</div><div class="line">&lt;!-- Spring security start --&gt;</div><div class="line">&lt;filter&gt;</div><div class="line">	&lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;</div><div class="line">	&lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;</div><div class="line">&lt;/filter&gt;</div><div class="line">&lt;filter-mapping&gt;</div><div class="line">	&lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;</div><div class="line">	&lt;url-pattern&gt;/*&lt;/url-pattern&gt;</div><div class="line">&lt;/filter-mapping&gt;</div><div class="line">&lt;!-- Spring security end  --&gt;</div></pre></td></tr></table></figure>
<p><strong>注意</strong>：filter-name一定要写成springSecurityFilterChain。在DelegatingFilterProxy类init时，会获取filter-name，然后通过filter-name去spring中获取代理的bean</p>
<h2 id="applicationContext-security-xml配置"><a href="#applicationContext-security-xml配置" class="headerlink" title="applicationContext-security.xml配置"></a>applicationContext-security.xml配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div></pre></td><td class="code"><pre><div class="line">&lt;beans:beans xmlns=&quot;http://www.springframework.org/schema/security&quot;</div><div class="line">	xmlns:beans=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">	xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</div><div class="line">	http://www.springframework.org/schema/beans/spring-beans-4.1.xsd</div><div class="line">	http://www.springframework.org/schema/jdbc</div><div class="line">	http://www.springframework.org/schema/jdbc/spring-jdbc-4.1.xsd</div><div class="line">	http://www.springframework.org/schema/security</div><div class="line">	http://www.springframework.org/schema/security/spring-security-4.0.xsd&quot;&gt;</div><div class="line"></div><div class="line">	&lt;!-- 启用注解  --&gt;</div><div class="line">	&lt;global-method-security secured-annotations=&quot;enabled&quot;</div><div class="line">		jsr250-annotations=&quot;enabled&quot; pre-post-annotations=&quot;enabled&quot; /&gt;</div><div class="line"></div><div class="line"></div><div class="line">        &lt;!-- 配置不需要权限验证页面和资源 --&gt;</div><div class="line">	&lt;http pattern=&quot;/admin/login.jsp&quot; security=&quot;none&quot;/&gt;&lt;!--登录页面  --&gt;</div><div class="line">	&lt;http pattern=&quot;/admin/xx/**&quot; security=&quot;none&quot;/&gt;&lt;!--静态资源 --&gt;</div><div class="line">	&lt;http pattern=&quot;/admin/none/**&quot; security=&quot;none&quot;/&gt;</div><div class="line">	</div><div class="line">	&lt;http use-expressions=&quot;true&quot; pattern=&quot;/admin/**&quot;  </div><div class="line">	  entry-point-ref=&quot;authenticationProcessingFilterEntryPoint&quot; </div><div class="line">	  authentication-manager-ref=&quot;adminAuthenticationManager&quot;&gt;  </div><div class="line">	               </div><div class="line">		&lt;!-- 是否关闭csrf，spring security4默认为开启  --&gt;</div><div class="line">		&lt;csrf disabled=&quot;true&quot; /&gt; </div><div class="line">		</div><div class="line">		&lt;!-- 设置可以在iframe显示数据  --&gt;</div><div class="line">		&lt;headers&gt;</div><div class="line">	        &lt;frame-options policy=&quot;SAMEORIGIN&quot;/&gt;</div><div class="line">	    &lt;/headers&gt;</div><div class="line">	    </div><div class="line">	    &lt;port-mappings&gt;</div><div class="line">		     &lt;port-mapping http=&quot;8080&quot; https=&quot;9988&quot;/&gt;</div><div class="line">		&lt;/port-mappings&gt;</div><div class="line">	</div><div class="line">		&lt;!--  权限校验 --&gt;</div><div class="line">		&lt;intercept-url pattern=&quot;/admin/index.jsp&quot; access=&quot;hasAuthority(&apos;admin:role&apos;) or hasAuthority(&apos;SUPER_ADMIN&apos;)&quot; /&gt;</div><div class="line">		&lt;intercept-url pattern=&quot;/admin/menu/**&quot; access=&quot;hasAuthority(&apos;admin:role&apos;) or hasAuthority(&apos;SUPER_ADMIN&apos;)&quot; /&gt;</div><div class="line">		&lt;intercept-url pattern=&quot;/admin/pattern/**&quot; access=&quot;hasAuthority(&apos;admin:role&apos;) or hasAuthority(&apos;SUPER_ADMIN&apos;)&quot; /&gt;</div><div class="line">		&lt;intercept-url pattern=&quot;/admin/odds/**&quot; access=&quot;hasAuthority(&apos;admin:role&apos;) or hasAuthority(&apos;SUPER_ADMIN&apos;)&quot; /&gt;</div><div class="line">		&lt;intercept-url pattern=&quot;/admin/period/**&quot; access=&quot;hasAuthority(&apos;admin:role&apos;) or hasAuthority(&apos;SUPER_ADMIN&apos;)&quot; /&gt;</div><div class="line">		&lt;intercept-url pattern=&quot;/admin/code/**&quot; access=&quot;hasAuthority(&apos;admin:role&apos;) or hasAuthority(&apos;SUPER_ADMIN&apos;)&quot; /&gt;</div><div class="line">		&lt;intercept-url pattern=&quot;/admin/code/collection/**&quot; access=&quot;hasAuthority(&apos;admin:role&apos;) or hasAuthority(&apos;SUPER_ADMIN&apos;)&quot; /&gt;</div><div class="line">		&lt;intercept-url pattern=&quot;/admin/member/**&quot; access=&quot;hasAuthority(&apos;admin:role&apos;) or hasAuthority(&apos;SUPER_ADMIN&apos;)&quot; /&gt;</div><div class="line">		&lt;intercept-url pattern=&quot;/admin/statistics/**&quot; access=&quot;hasAuthority(&apos;admin:role&apos;) or hasAuthority(&apos;SUPER_ADMIN&apos;)&quot; /&gt;</div><div class="line">		&lt;intercept-url pattern=&quot;/admin/order/**&quot; access=&quot;hasAuthority(&apos;admin:role&apos;) or hasAuthority(&apos;SUPER_ADMIN&apos;)&quot; /&gt;</div><div class="line">	</div><div class="line">          </div><div class="line">                &lt;form-login login-page=&quot;/admin/login.jsp&quot;</div><div class="line">    	      	username-parameter=&quot;account&quot; password-parameter=&quot;pwd&quot; </div><div class="line">    	         login-processing-url=&quot;/admin/loginIn&quot; </div><div class="line">    	         authentication-success-handler-ref=&quot;authSuccess&quot;</div><div class="line">    	         authentication-failure-handler-ref=&quot;authFailure&quot;</div><div class="line">                /&gt;</div><div class="line">	       </div><div class="line">	       &lt;logout invalidate-session=&quot;true&quot; logout-url=&quot;/admin/loginOut&quot;</div><div class="line">			success-handler-ref=&quot;adminLogoutSuccessHandler&quot; delete-cookies=&quot;JSESSIONID&quot; /&gt;</div><div class="line">	       </div><div class="line">		      </div><div class="line">	      &lt;access-denied-handler ref=&quot;adminAccessDeniedHandler&quot; /&gt;</div><div class="line">		      </div><div class="line">		  &lt;!-- remember me功能 --&gt;</div><div class="line">    	  &lt;remember-me user-service-ref=&quot;adminDetailsService&quot; </div><div class="line">    			key=&quot;clq&quot; token-validity-seconds=&quot;18000&quot;</div><div class="line">    			remember-me-parameter=&quot;rememberMe&quot; token-repository-ref=&quot;adminTokenRepository&quot;/&gt;</div><div class="line">					</div><div class="line">		&lt;!-- 控制同时在线人数  --&gt;</div><div class="line">           &lt;session-management &gt;</div><div class="line">			&lt;concurrency-control max-sessions=&quot;1&quot; session-registry-ref=&quot;sessionRegistry&quot;</div><div class="line">			expired-url=&quot;/admin/none/session_expired.jsp&quot; /&gt; </div><div class="line">		&lt;/session-management&gt;</div><div class="line">			</div><div class="line">    &lt;/http&gt;  </div><div class="line">    </div><div class="line">    &lt;!-- 登录成功处理类 --&gt;</div><div class="line">    &lt;beans:bean id=&quot;authSuccess&quot; class=&quot;com.xx.security.admin.AuthenticationSuccessHandlerImpl&quot;&gt;&lt;/beans:bean&gt;</div><div class="line">    &lt;!--  登录失败处理类 --&gt;</div><div class="line">    &lt;beans:bean id=&quot;authFailure&quot; class=&quot;com.xx.security.admin.AuthenticationFailureHandlerImpl&quot;&gt;&lt;/beans:bean&gt;</div><div class="line">    &lt;!--  没有权限处理类 --&gt;</div><div class="line">    &lt;beans:bean id=&quot;adminAccessDeniedHandler&quot; class=&quot;com.xx.security.admin.AdminAccessDeniedHandler&quot;&gt;&lt;/beans:bean&gt;</div><div class="line">    &lt;!--  退出成功处理类 --&gt;</div><div class="line">    &lt;beans:bean id=&quot;adminLogoutSuccessHandler&quot; class=&quot;com.xx.security.admin.AdminLogoutSuccessHandler&quot;&gt;&lt;/beans:bean&gt;</div><div class="line">    </div><div class="line">    </div><div class="line">    &lt;authentication-manager id=&quot;adminAuthenticationManager&quot;&gt;  </div><div class="line">        &lt;authentication-provider ref=&quot;adminAuthenticationProvider&quot;&gt;  </div><div class="line">        &lt;/authentication-provider&gt;  </div><div class="line">    &lt;/authentication-manager&gt;</div><div class="line">    </div><div class="line">    &lt;beans:bean id=&quot;adminDetailsService&quot; class=&quot;com.xx.security.admin.AdminDetailsService&quot;&gt;&lt;/beans:bean&gt;</div><div class="line">    </div><div class="line">    &lt;beans:bean id=&quot;adminAuthenticationProvider&quot;  class=&quot;com.xx.security.admin.AdminAuthenticationProvider&quot;&gt;</div><div class="line">        &lt;beans:property name=&quot;userDetailsService&quot; ref=&quot;adminDetailsService&quot; /&gt;</div><div class="line">    &lt;/beans:bean&gt;  </div><div class="line">    </div><div class="line">    &lt;!-- AuthenticationEntryPoint，引导用户进行登录 --&gt;</div><div class="line">   &lt;beans:bean id=&quot;authenticationProcessingFilterEntryPoint&quot; class=&quot;org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint&quot;&gt;</div><div class="line">       &lt;beans:constructor-arg name=&quot;loginFormUrl&quot; value=&quot;/admin/login.jsp&quot;  /&gt;</div><div class="line">    &lt;/beans:bean&gt;</div><div class="line">    </div><div class="line">    &lt;beans:bean id=&quot;adminTokenRepository&quot;</div><div class="line">		class=&quot;com.xx.security.admin.AdminJdbcTokenRepositoryImpl&quot;&gt;</div><div class="line">		&lt;!-- 数据源 --&gt;</div><div class="line">		&lt;beans:property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;</div><div class="line">		&lt;!-- 是否在系统启动时创建持久化token的数据库表 --&gt;</div><div class="line">		&lt;beans:property name=&quot;createTableOnStartup&quot; value=&quot;false&quot; /&gt;</div><div class="line">	&lt;/beans:bean&gt;</div><div class="line">	</div><div class="line">  &lt;beans:bean id=&quot;sessionRegistry&quot; class=&quot;org.springframework.security.core.session.SessionRegistryImpl&quot; /&gt;</div><div class="line"></div><div class="line">&lt;/beans:beans&gt;</div></pre></td></tr></table></figure>
<h2 id="AdminDetails（权限实体"><a href="#AdminDetails（权限实体" class="headerlink" title="AdminDetails（权限实体)"></a>AdminDetails（权限实体)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">package com.xx.security.admin;</div><div class="line"></div><div class="line">import java.util.Collection;</div><div class="line">import org.springframework.security.core.GrantedAuthority;</div><div class="line">import org.springframework.security.core.userdetails.User;</div><div class="line"></div><div class="line">public class AdminDetails extends User &#123;</div><div class="line">	private static final long serialVersionUID = 1L;</div><div class="line">    </div><div class="line">	private Integer id;</div><div class="line">	private Byte enable;//是否可用：1:可用   -1:禁用</div><div class="line">	private Byte isSys;//是否是超级管理员：1:是  -1：否</div><div class="line"></div><div class="line">	public AdminDetails(String username, String password, boolean enabled, boolean accountNonExpired,</div><div class="line">			boolean credentialsNonExpired, boolean accountNonLocked, Collection&lt;? extends GrantedAuthority&gt; authorities,</div><div class="line">			Byte enable, Byte isSys, Integer id) &#123;</div><div class="line">		super(username, password, enabled, accountNonExpired, credentialsNonExpired, accountNonLocked, authorities);</div><div class="line"></div><div class="line">		this.id = id;</div><div class="line">		this.enable = enable;</div><div class="line">		this.isSys = isSys;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public AdminDetails(String username, String password, Collection&lt;? extends GrantedAuthority&gt; authorities,</div><div class="line">			Byte enable, Byte isSys, Integer id) &#123;</div><div class="line">		super(username, password, authorities);</div><div class="line"></div><div class="line">		this.id = id;</div><div class="line">		this.enable = enable;</div><div class="line">		this.isSys = isSys;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public Integer getId() &#123;</div><div class="line">		return id;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void setId(Integer id) &#123;</div><div class="line">		this.id = id;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public Byte getEnable() &#123;</div><div class="line">		return enable;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void setEnable(Byte enable) &#123;</div><div class="line">		this.enable = enable;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public Byte getIsSys() &#123;</div><div class="line">		return isSys;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void setIsSys(Byte isSys) &#123;</div><div class="line">		this.isSys = isSys;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="加载权限Service"><a href="#加载权限Service" class="headerlink" title="加载权限Service"></a>加载权限Service</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div></pre></td><td class="code"><pre><div class="line">package com.xx.security.admin;</div><div class="line"></div><div class="line">import java.util.HashSet;</div><div class="line">import java.util.List;</div><div class="line">import java.util.Set;</div><div class="line"></div><div class="line">import javax.annotation.Resource;</div><div class="line"></div><div class="line">import org.slf4j.Logger;</div><div class="line">import org.slf4j.LoggerFactory;</div><div class="line">import org.springframework.security.core.authority.SimpleGrantedAuthority;</div><div class="line">import org.springframework.security.core.userdetails.UserDetails;</div><div class="line">import org.springframework.security.core.userdetails.UserDetailsService;</div><div class="line">import org.springframework.security.core.userdetails.UsernameNotFoundException;</div><div class="line">import org.springframework.transaction.annotation.Transactional;</div><div class="line">import org.springframework.util.Assert;</div><div class="line"></div><div class="line">import com.lhc.entity.jpa.SysAdminEntity;</div><div class="line">import com.lhc.entity.jpa.SysAuthorityEntity;</div><div class="line">import com.lhc.entity.jpa.SysRoleEntity;</div><div class="line">import com.lhc.repository.SysAdminJpaRepository;</div><div class="line">import com.lhc.security.constants.AdminSecurityConstant;</div><div class="line"></div><div class="line">@Transactional</div><div class="line">public class AdminDetailsService implements UserDetailsService &#123;</div><div class="line">	private static final Logger logger = LoggerFactory.getLogger(AdminDetailsService.class);</div><div class="line"></div><div class="line">	@Resource</div><div class="line">	SysAdminJpaRepository sysAdminJpaRepository;</div><div class="line">	</div><div class="line">	public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException &#123;</div><div class="line">		</div><div class="line">		    logger.info(&quot;loadUserByUsername start&quot;);</div><div class="line">		     logger.info(&quot;username: &#123;&#125;&quot;, username);</div><div class="line">		     </div><div class="line">		     SysAdminEntity sysAdminEntity = sysAdminJpaRepository.findByUsername(username);</div><div class="line">		     </div><div class="line">		     Assert.notNull(sysAdminEntity, &quot;[username:&quot; + username + &quot;] admin is not exist&quot;);</div><div class="line">		     /*if (null == sysAdminEntity) &#123;</div><div class="line">		    	 throw new UsernameNotFoundException(&quot;[username:&quot; + username + &quot;] admin is not exist&quot;);</div><div class="line">		     &#125;*/</div><div class="line">		     </div><div class="line">		     if (sysAdminEntity.getIsSys().equals(AdminSecurityConstant.SUPER_ADMIN_YES)) &#123;</div><div class="line">			      Set&lt;SimpleGrantedAuthority&gt; supuerAuthority = new HashSet&lt;SimpleGrantedAuthority&gt;();</div><div class="line">			      SimpleGrantedAuthority superAuth = new SimpleGrantedAuthority(&quot;SUPER_ADMIN&quot;);</div><div class="line">			      supuerAuthority.add(superAuth);</div><div class="line">			       </div><div class="line">			 </div><div class="line">			      AdminDetails adminDetails = new AdminDetails(sysAdminEntity.getUsername(), sysAdminEntity.getPassword(), </div><div class="line">			    		  true, true, true, true, supuerAuthority, sysAdminEntity.getEnable(), </div><div class="line">			    		  sysAdminEntity.getIsSys(),  sysAdminEntity.getId());</div><div class="line">			       </div><div class="line">			      logger.info(&quot;the loginer is super admin ,loadUserByUsername end&quot;);</div><div class="line">			      return adminDetails;</div><div class="line">		     &#125;</div><div class="line">		     </div><div class="line">		     List&lt;SysRoleEntity&gt; roleList = sysAdminEntity.getListOfSysRole();</div><div class="line">		     </div><div class="line">		     Assert.notEmpty(roleList, &quot;[username:&quot; + username + &quot;] admin has not roles&quot;);</div><div class="line">		    /*if ((null == roleList) || (roleList.size() == 0)) &#123;</div><div class="line">		    	throw new UsernameNotFoundException(&quot;[username:&quot; + username + &quot;] admin has not roles&quot;);</div><div class="line">		     &#125;*/</div><div class="line">		     </div><div class="line">		     Set&lt;SimpleGrantedAuthority&gt; authorities = new HashSet&lt;SimpleGrantedAuthority&gt;();</div><div class="line">		    SimpleGrantedAuthority auth = null;</div><div class="line">		     for (SysRoleEntity sysRoleEntity : roleList) &#123;</div><div class="line">			      if (sysRoleEntity.getEnable().equals(AdminSecurityConstant.ENABLE_YES)) &#123;</div><div class="line">			         </div><div class="line">				         List&lt;SysAuthorityEntity&gt; authList = sysRoleEntity.getListOfsysAuthority();</div><div class="line">				         for (SysAuthorityEntity sysAuthorityEntity : authList) &#123;</div><div class="line">					         auth = new SimpleGrantedAuthority(sysAuthorityEntity.getAuthMark());</div><div class="line">					         authorities.add(auth);</div><div class="line">				         &#125;</div><div class="line">			       &#125;</div><div class="line">		     &#125;</div><div class="line">		     </div><div class="line">		     Assert.notEmpty(authorities, &quot;[username:&quot; + username + &quot;] admin has not roles&quot;);</div><div class="line">		     /*if ((null == authorities) || (authorities.size() == 0)) &#123;</div><div class="line">		    	 throw new UsernameNotFoundException(&quot;[username:&quot; + username + &quot;] admin has not authorities&quot;);</div><div class="line">		     &#125;*/</div><div class="line">		     </div><div class="line">		     for (SimpleGrantedAuthority sga : authorities) &#123;</div><div class="line">		    	 System.out.println(&quot;登录用户所拥有的权限：&quot; + sga.getAuthority());</div><div class="line">		     &#125;</div><div class="line">		 </div><div class="line">		   AdminDetails adminDetails = new AdminDetails(sysAdminEntity.getUsername(), sysAdminEntity.getPassword(), </div><div class="line">				   true, true, true, true, authorities, sysAdminEntity.getEnable(), </div><div class="line">				   sysAdminEntity.getIsSys(),  sysAdminEntity.getId());</div><div class="line">		     </div><div class="line">		    logger.info(&quot;loadUserByUsername end&quot;);</div><div class="line">		    return adminDetails;</div><div class="line">		&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<h2 id="权限校验提供者（Provider）"><a href="#权限校验提供者（Provider）" class="headerlink" title="权限校验提供者（Provider）"></a>权限校验提供者（Provider）</h2><p>加载完权限后，在此校验<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">package com.xx.security.admin;</div><div class="line"></div><div class="line">import org.apache.commons.logging.Log;</div><div class="line">import org.apache.commons.logging.LogFactory;</div><div class="line">import org.springframework.security.authentication.BadCredentialsException;</div><div class="line">import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</div><div class="line">import org.springframework.security.authentication.dao.DaoAuthenticationProvider;</div><div class="line">import org.springframework.security.core.AuthenticationException;</div><div class="line">import org.springframework.security.core.userdetails.UserDetails;</div><div class="line"></div><div class="line">import com.lhc.security.constants.AdminSecurityConstant;</div><div class="line">import com.lhc.utils.EncryptUtil;</div><div class="line"></div><div class="line">public class AdminAuthenticationProvider extends DaoAuthenticationProvider &#123;</div><div class="line">	protected final Log logger = LogFactory.getLog(getClass());</div><div class="line"></div><div class="line">	protected void additionalAuthenticationChecks(UserDetails userDetails,</div><div class="line">			UsernamePasswordAuthenticationToken authentication) throws AuthenticationException &#123;</div><div class="line">		</div><div class="line">		this.logger.info(&quot;AdminAuthenticationProvider:&#123;&#125;  authenticate start&quot;);</div><div class="line">		AdminDetails adminDetails = (AdminDetails) userDetails;</div><div class="line"></div><div class="line">		if (authentication.getCredentials() == null) &#123;</div><div class="line">			this.logger.debug(&quot;Authentication failed: no credentials provided&quot;);</div><div class="line"></div><div class="line">			throw new BadCredentialsException(this.messages</div><div class="line">					.getMessage(&quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;, &quot;Bad credentials&quot;));</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		//获取登录密码</div><div class="line">		String presentedPassword = authentication.getCredentials().toString();</div><div class="line"></div><div class="line">		if (!EncryptUtil.match(presentedPassword, adminDetails.getPassword())) &#123;//校验密码是否一致</div><div class="line">			this.logger.debug(&quot;Authentication failed: password does not match stored value&quot;);</div><div class="line"></div><div class="line">			throw new BadCredentialsException(this.messages</div><div class="line">					.getMessage(&quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;, &quot;Bad credentials&quot;));</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		if (adminDetails.getEnable().equals(AdminSecurityConstant.ENABLE_NO)) &#123;</div><div class="line">			this.logger.error(&quot;Authentication failed: &quot; + adminDetails.getUsername() + &quot; is forbided&quot;);</div><div class="line"></div><div class="line">			throw new BadCredentialsException(</div><div class="line">					this.messages.getMessage(&quot;Authentication failed: &quot; + adminDetails.getUsername() + &quot; is forbided&quot;));</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		this.logger.info(&quot;AdminAuthenticationProvider:&#123;&#125;  authenticate end&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public boolean supports(Class&lt;?&gt; authentication) &#123;</div><div class="line">		return authentication.equals(UsernamePasswordAuthenticationToken.class);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="验证成功处理类"><a href="#验证成功处理类" class="headerlink" title="验证成功处理类"></a>验证成功处理类</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">package com.xx.security.admin;</div><div class="line"></div><div class="line">import java.io.IOException;</div><div class="line">import java.util.Date;</div><div class="line"></div><div class="line">import javax.annotation.Resource;</div><div class="line">import javax.servlet.ServletException;</div><div class="line">import javax.servlet.http.HttpServletRequest;</div><div class="line">import javax.servlet.http.HttpServletResponse;</div><div class="line">import org.apache.commons.logging.Log;</div><div class="line">import org.apache.commons.logging.LogFactory;</div><div class="line">import org.springframework.security.core.Authentication;</div><div class="line">import org.springframework.security.web.DefaultRedirectStrategy;</div><div class="line">import org.springframework.security.web.RedirectStrategy;</div><div class="line">import org.springframework.security.web.authentication.AuthenticationSuccessHandler;</div><div class="line"></div><div class="line">import com.lhc.entity.jpa.MemberEntity;</div><div class="line">import com.lhc.entity.jpa.SysAdminEntity;</div><div class="line">import com.lhc.repository.SysAdminJpaRepository;</div><div class="line">import com.lhc.security.member.MemberDetails;</div><div class="line"></div><div class="line">public class AuthenticationSuccessHandlerImpl implements AuthenticationSuccessHandler &#123;</div><div class="line">	protected final Log logger = LogFactory.getLog(getClass());</div><div class="line">	private RedirectStrategy redirectStrategy = new DefaultRedirectStrategy();</div><div class="line">	private String defaultTargetUrl = &quot;/admin/index.jsp&quot;;</div><div class="line">	</div><div class="line">	@Resource</div><div class="line">	SysAdminJpaRepository sysAdminJpaRepository;</div><div class="line"></div><div class="line">	public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response,</div><div class="line">			Authentication authentication) throws IOException, ServletException &#123;</div><div class="line">		//这里处理验证成功后的逻辑</div><div class="line">			</div><div class="line">		if (response.isCommitted()) &#123;</div><div class="line">			this.logger.debug(&quot;Response has already been committed. Unable to redirect to &quot; + this.defaultTargetUrl);</div><div class="line">			return;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		//更新最后登录时间</div><div class="line">		Object principal = authentication.getPrincipal();</div><div class="line">		AdminDetails adminDetails = null;</div><div class="line">		if (principal instanceof AdminDetails) &#123;</div><div class="line">			adminDetails =  (AdminDetails) principal;</div><div class="line">			SysAdminEntity sysAdminEntity = sysAdminJpaRepository.findOne(adminDetails.getId());</div><div class="line">			sysAdminEntity.setLastLogin(new Date(System.currentTimeMillis()));</div><div class="line">			</div><div class="line">			sysAdminJpaRepository.save(sysAdminEntity);</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		this.logger.info(&quot;admin authentication success&quot;);</div><div class="line">		this.redirectStrategy.sendRedirect(request, response, this.defaultTargetUrl);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="验证失败处理类"><a href="#验证失败处理类" class="headerlink" title="验证失败处理类"></a>验证失败处理类</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">package com.xx.security.admin;</div><div class="line"></div><div class="line">import java.io.IOException;</div><div class="line">import javax.servlet.ServletException;</div><div class="line">import javax.servlet.http.HttpServletRequest;</div><div class="line">import javax.servlet.http.HttpServletResponse;</div><div class="line">import org.slf4j.Logger;</div><div class="line">import org.slf4j.LoggerFactory;</div><div class="line">import org.springframework.security.core.AuthenticationException;</div><div class="line">import org.springframework.security.web.authentication.AuthenticationFailureHandler;</div><div class="line"></div><div class="line">public class AuthenticationFailureHandlerImpl implements AuthenticationFailureHandler &#123;</div><div class="line">	private static final Logger logger = LoggerFactory.getLogger(AuthenticationFailureHandlerImpl.class);</div><div class="line"></div><div class="line">	public void onAuthenticationFailure(HttpServletRequest request, HttpServletResponse response,</div><div class="line">			AuthenticationException exception) throws IOException, ServletException &#123;</div><div class="line">		//这里处理验证失败处理逻辑	</div><div class="line">		</div><div class="line">		logger.info(&quot;authentication failure&quot;);</div><div class="line">		response.sendError(401, &quot;Authentication Failed: &quot; + exception.getMessage());</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="没有权限处理类"><a href="#没有权限处理类" class="headerlink" title="没有权限处理类"></a>没有权限处理类</h2><p>与验证失败不同，此处是验证成功，但是没有操作权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">package com.xx.security.admin;</div><div class="line"></div><div class="line">import java.io.IOException;</div><div class="line"></div><div class="line">import javax.servlet.ServletException;</div><div class="line">import javax.servlet.http.HttpServletRequest;</div><div class="line">import javax.servlet.http.HttpServletResponse;</div><div class="line"></div><div class="line">import org.springframework.security.access.AccessDeniedException;</div><div class="line">import org.springframework.security.web.access.AccessDeniedHandler;</div><div class="line"></div><div class="line">public class AdminAccessDeniedHandler implements AccessDeniedHandler &#123;</div><div class="line">	public void handle(HttpServletRequest request, HttpServletResponse response,</div><div class="line">			AccessDeniedException accessDeniedException) throws IOException, ServletException &#123;</div><div class="line">		response.setHeader(&quot;Content-type&quot;, &quot;text/html;charset=UTF-8&quot;);</div><div class="line">		response.getWriter().print(&quot;您没有操作权限&quot;);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="退出登录处理类"><a href="#退出登录处理类" class="headerlink" title="退出登录处理类"></a>退出登录处理类</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">package com.xx.security.admin;</div><div class="line"></div><div class="line">import java.io.IOException;</div><div class="line">import javax.servlet.ServletException;</div><div class="line">import javax.servlet.http.HttpServletRequest;</div><div class="line">import javax.servlet.http.HttpServletResponse;</div><div class="line">import org.slf4j.Logger;</div><div class="line">import org.slf4j.LoggerFactory;</div><div class="line">import org.springframework.security.core.Authentication;</div><div class="line">import org.springframework.security.web.authentication.logout.LogoutSuccessHandler;</div><div class="line"></div><div class="line">public class AdminLogoutSuccessHandler implements LogoutSuccessHandler &#123;</div><div class="line">	private static final Logger logger = LoggerFactory.getLogger(AdminLogoutSuccessHandler.class);</div><div class="line"></div><div class="line">	public void onLogoutSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</div><div class="line">			throws IOException, ServletException &#123;</div><div class="line">		logger.info(&quot; logout success&quot;);</div><div class="line">		response.sendRedirect(&quot;http://admin.online.com/lhc/none/logout_success.jsp&quot;);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="密码工具"><a href="#密码工具" class="headerlink" title="密码工具"></a>密码工具</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">package com.xx.utils;</div><div class="line"></div><div class="line">import org.springframework.security.crypto.password.PasswordEncoder;</div><div class="line">import org.springframework.security.crypto.password.StandardPasswordEncoder;</div><div class="line"></div><div class="line">/**</div><div class="line"> *  密码处理工具</div><div class="line"> * @author clq</div><div class="line"> */</div><div class="line">public class EncryptUtil &#123;</div><div class="line">	private static final String SITE_WIDE_SECRET = &quot;clq&quot;;</div><div class="line">	private static final PasswordEncoder encoder = new StandardPasswordEncoder(SITE_WIDE_SECRET);</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 加密</div><div class="line">	 * @param rawPassword</div><div class="line">	 * @return</div><div class="line">	 */</div><div class="line">	public static String encrypt(String rawPassword) &#123;</div><div class="line">		return encoder.encode(rawPassword);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 *  校验密码是否匹配</div><div class="line">	 * @param rawPassword 原始密码</div><div class="line">	 * @param password 加密后的密码</div><div class="line">	 * @return</div><div class="line">	 */</div><div class="line">	public static boolean match(String rawPassword, String password) &#123;</div><div class="line">		return encoder.matches(rawPassword, password);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	public static void main(String[] args) &#123;</div><div class="line">		String s = &quot;123456&quot;;</div><div class="line">		String s1 = EncryptUtil.encrypt(s);</div><div class="line">		String s2 = EncryptUtil.encrypt(s);</div><div class="line">        System.out.println(s1);  </div><div class="line">        System.out.println(s2);  </div><div class="line">        System.out.println(match(s, s2));  </div><div class="line">        //但是把每次结果拿出来进行match，你会发现可以得到true。  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="获取登录信息工具类"><a href="#获取登录信息工具类" class="headerlink" title="获取登录信息工具类"></a>获取登录信息工具类</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">package com.xx.security.common;</div><div class="line"></div><div class="line">import org.springframework.data.domain.AuditorAware;</div><div class="line">import org.springframework.security.core.Authentication;</div><div class="line">import org.springframework.security.core.context.SecurityContextHolder;</div><div class="line">import org.springframework.stereotype.Component;</div><div class="line"></div><div class="line">import com.lhc.security.admin.AdminDetails;</div><div class="line">import com.lhc.security.member.MemberDetails;</div><div class="line"></div><div class="line">@Component(&quot;springSecurityAuditorAware&quot;)</div><div class="line">public class SpringSecurityAuditorAware implements AuditorAware&lt;Integer&gt; &#123;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public Integer getCurrentAuditor() &#123;</div><div class="line"></div><div class="line">		Authentication authentication = SecurityContextHolder.getContext().getAuthentication();</div><div class="line"></div><div class="line">		if (authentication == null || !authentication.isAuthenticated()) &#123;</div><div class="line">			return 0;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		Object principal = authentication.getPrincipal();</div><div class="line">		if (principal instanceof AdminDetails) &#123;</div><div class="line">			return ((AdminDetails)principal).getId();</div><div class="line">		&#125;</div><div class="line">		if (principal instanceof MemberDetails) &#123;</div><div class="line">			return ((MemberDetails)principal).getId();</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		return 0;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	public AdminDetails getCurrentAdmin() &#123;</div><div class="line">		Authentication authentication = SecurityContextHolder.getContext().getAuthentication();</div><div class="line">		</div><div class="line">		if (authentication == null || !authentication.isAuthenticated()) &#123;</div><div class="line">			return null;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		Object principal = authentication.getPrincipal();</div><div class="line">		if (principal instanceof AdminDetails) &#123;</div><div class="line">			return ((AdminDetails)principal);</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		return null;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	public MemberDetails getCurrentMember() &#123;</div><div class="line">		Authentication authentication = SecurityContextHolder.getContext().getAuthentication();</div><div class="line">		</div><div class="line">		if (authentication == null || !authentication.isAuthenticated()) &#123;</div><div class="line">			return null;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		Object principal = authentication.getPrincipal();</div><div class="line">		if (principal instanceof MemberDetails) &#123;</div><div class="line">			return ((MemberDetails)principal);</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		return null;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="数据库结构"><a href="#数据库结构" class="headerlink" title="数据库结构"></a>数据库结构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE `sys_admin` (</div><div class="line">  `id` int(10) NOT NULL AUTO_INCREMENT COMMENT &apos;主键&apos;,</div><div class="line">  `name` varchar(50) DEFAULT NULL COMMENT &apos;用户名&apos;,</div><div class="line">  `username` varchar(50) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT &apos;登录名&apos;,</div><div class="line">  `password` varchar(100) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT &apos;密码&apos;,</div><div class="line">  `last_login` datetime DEFAULT NULL COMMENT &apos;最后登录时间&apos;,</div><div class="line">  `login_ip` varchar(20) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT &apos;最后登录的ip&apos;,</div><div class="line">  `enable` int(2) DEFAULT &apos;1&apos; COMMENT &apos;是否可用：1:可用   0:禁用&apos;,</div><div class="line">  `is_sys` int(2) DEFAULT &apos;0&apos; COMMENT &apos;是否是超级管理员：1:是  0：否&apos;,</div><div class="line">  `created_date` datetime DEFAULT NULL COMMENT &apos;创建时间&apos;,</div><div class="line">  `created_by` int(10) DEFAULT &apos;0&apos; COMMENT &apos;创建人&apos;,</div><div class="line">  `modified_date` datetime DEFAULT NULL COMMENT &apos;更新时间&apos;,</div><div class="line">  `modified_by` int(10) DEFAULT &apos;0&apos; COMMENT &apos;更新人&apos;,</div><div class="line">  PRIMARY KEY (`id`)</div><div class="line">) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;</div><div class="line"></div><div class="line">CREATE TABLE `sys_admin_role` (</div><div class="line">  `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT &apos;主键&apos;,</div><div class="line">  `admin_id` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;管理员id&apos;,</div><div class="line">  `role_id` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;角色id&apos;,</div><div class="line">  PRIMARY KEY (`id`),</div><div class="line">  KEY `FK4k43lklts7m27m6gyy75qvg4h` (`role_id`),</div><div class="line">  KEY `FKcni2xdl3ht8u90us3wwscui99` (`admin_id`),</div><div class="line">  CONSTRAINT `FK4k43lklts7m27m6gyy75qvg4h` FOREIGN KEY (`role_id`) REFERENCES `sys_role` (`id`),</div><div class="line">  CONSTRAINT `FKcni2xdl3ht8u90us3wwscui99` FOREIGN KEY (`admin_id`) REFERENCES `sys_admin` (`id`)</div><div class="line">) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;</div><div class="line"></div><div class="line">CREATE TABLE `sys_authority` (</div><div class="line">  `id` int(10) NOT NULL AUTO_INCREMENT COMMENT &apos;主键&apos;,</div><div class="line">  `auth_mark` varchar(50) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT &apos;权限标示&apos;,</div><div class="line">  `auth_name` varchar(50) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT &apos;权限名称&apos;,</div><div class="line">  `auth_desc` varchar(100) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT &apos;权限描述&apos;,</div><div class="line">  `enable` int(2) DEFAULT &apos;1&apos; COMMENT &apos;是否可用：1:可用  0:禁用&apos;,</div><div class="line">  `created_date` datetime DEFAULT NULL COMMENT &apos;创建时间&apos;,</div><div class="line">  `created_by` int(10) DEFAULT &apos;0&apos; COMMENT &apos;创建人&apos;,</div><div class="line">  `modified_date` datetime DEFAULT NULL COMMENT &apos;更新时间&apos;,</div><div class="line">  `modified_by` int(10) DEFAULT &apos;0&apos; COMMENT &apos;更新人&apos;,</div><div class="line">  PRIMARY KEY (`id`)</div><div class="line">) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;</div><div class="line"></div><div class="line">CREATE TABLE `sys_role` (</div><div class="line">  `id` int(10) NOT NULL AUTO_INCREMENT COMMENT &apos;主键&apos;,</div><div class="line">  `role_name` varchar(50) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT NULL COMMENT &apos;角色名称&apos;,</div><div class="line">  `role_desc` varchar(100) DEFAULT NULL COMMENT &apos;角色描述&apos;,</div><div class="line">  `enable` int(2) DEFAULT &apos;1&apos; COMMENT &apos;是否可用：1:可用  0:禁用&apos;,</div><div class="line">  `created_date` datetime DEFAULT NULL COMMENT &apos;创建时间&apos;,</div><div class="line">  `created_by` int(10) DEFAULT &apos;0&apos; COMMENT &apos;创建人&apos;,</div><div class="line">  `modified_date` datetime DEFAULT NULL COMMENT &apos;更新时间&apos;,</div><div class="line">  `modified_by` int(10) DEFAULT &apos;0&apos; COMMENT &apos;更新人&apos;,</div><div class="line">  PRIMARY KEY (`id`)</div><div class="line">) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8;</div><div class="line"></div><div class="line">CREATE TABLE `sys_role_authority` (</div><div class="line">  `id` int(10) NOT NULL AUTO_INCREMENT COMMENT &apos;主键&apos;,</div><div class="line">  `role_id` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;角色主键&apos;,</div><div class="line">  `auth_id` int(10) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;权限主键&apos;,</div><div class="line">  PRIMARY KEY (`id`)</div><div class="line">) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;</div></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://clq2owesome.github.io/2017/08/15/Spring/Security/实践运用整合/" data-id="cjei8ydi1008s7obldg0w8mmd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/08/15/Spring/Security/配置十六：基于表达式的权限控制/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          配置十六：基于表达式的权限控制
        
      </div>
    </a>
  
  
    <a href="/2017/08/15/Spring/Security/配置十八：Jsp标签/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">配置十八：Jsp标签</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Eclipse/">Eclipse</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Github/">Github</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/Cookie/">Cookie</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/JAXB/">JAXB</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/JavaMail/">JavaMail</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/分布式/">分布式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/加密解密／编码解码/">加密解密／编码解码</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/基础/">基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/数据类型/">数据类型</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/日记/">日记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/时间日期/">时间日期</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/线程/">线程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/网络NIO/">网络NIO</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/队列/">队列</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/集合/">集合</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Maven/">Maven</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/Application-Event/">Application Event</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/JPA/">JPA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/Security/">Security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/Spring-Boot/">Spring Boot</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/Spring-Session/">Spring Session</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/Task/">Task</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/spring-MVC/">spring MVC</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/spring-data-redis/">spring data redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/基础/">基础</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端技术相关/">前端技术相关</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/前端技术相关/forever/">forever</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端技术相关/javascript/">javascript</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库相关/">数据库相关</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/数据库相关/mysql/">mysql</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/">服务器相关</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/Hessian/">Hessian</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/Hudson-Jenkins/">Hudson & Jenkins</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/Memcached/">Memcached</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/Nginx/">Nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/Tomcat/">Tomcat</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/red5/">red5</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/redis/">redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/resin/">resin</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/正则表达式/">正则表达式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络/">网络</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/03/08/正则表达式/正则表达式/">正则表达式</a>
          </li>
        
          <li>
            <a href="/2018/02/25/Java/集合/Hashtable与ConcurrentHashMap区别/">Hashtable与ConcurrentHashMap区别</a>
          </li>
        
          <li>
            <a href="/2018/02/25/Java/分布式/分布式事务/">分布式事务</a>
          </li>
        
          <li>
            <a href="/2018/02/25/Java/分布式/分布式锁/">分布式锁</a>
          </li>
        
          <li>
            <a href="/2018/02/25/Java/集合/在List循环中删除元素/">在List循环中删除元素</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 LeoChan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>