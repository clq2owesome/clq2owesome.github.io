<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="description" content="描述啊">
  <meta name="keywords" content="undefined">
  
    <link rel="icon" href="">
  
    
  <title>Filter过滤器 | LeoChan&#39;s 个人博客</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.css" />
</head>

<body>
  <header>
  <div class="header-container">
    <a class='logo' href="/">
      <span>LeoChan's 个人博客</span>
    </a>
    <ul class="right-header">
      
        <li class="nav-item">
          
            <a href="/" class="item-link">首页</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/about" class="item-link">关于</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/archives" class="item-link">归档</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/tags" class="item-link">标签</a>
          
        </li>
      
    </ul>
  </div>
</header>

  <main id='post'>
  <div class="content">
    <article>
        <section class="content markdown-body">
          <h1>Filter过滤器</h1>
          <div class='post-meta'>
            <i class="fa fa-calendar" aria-hidden="true"></i> <time>2017年08月28日</time>
            
              | <i class="fa fa-folder-open-o" aria-hidden="true"></i> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>/ <a class="article-category-link" href="/categories/Java/基础/">基础</a>
  </div>



            
            
          </div>
          <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Filter也称之为过滤器，它是Servlet技术中最激动人心的技术之一，WEB开发人员通过Filter技术，对web服务器管理的所有web资源：例如Jsp,Servlet,静态图片文件或静态html文件等进行拦截，从而实现一些特殊的功能。例如实现URL级别的权限访问控制、过滤敏感词汇、压缩响应信息等一些高级功能。  </p>
<p>Servlet API中提供了一个Filter接口，开发web应用时，如果编写的Java类实现了这个接口，则把这个java类称之为过滤器Filter。通过Filter技术，开发人员可以实现用户在访问某个目标资源之前，对访问的请求和响应进行拦截，Filter接口源代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public abstract interface Filter&#123;  </div><div class="line">    public abstract void init(FilterConfig paramFilterConfig) throws ServletException;  </div><div class="line">    public abstract void doFilter(ServletRequest paramServletRequest, ServletResponse paramServletResponse, FilterChain   </div><div class="line">        paramFilterChain) throws IOException, ServletException;  </div><div class="line">    public abstract void destroy();  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Servlet API中提供了一个Filter接口，开发web应用时，如果编写的Java类实现了这个接口，则把这个java类称之为过滤器Filter。通过Filter技术，开发人员可以实现用户在访问某个目标资源之前，对访问的请求和响应进行拦截，如下所示：<br><img src="http://images2015.cnblogs.com/blog/892393/201604/892393-20160425211729548-1717874729.png" alt="image"><br>filter是如何实现过滤的：<br>Filter接口中有一个doFilter方法，当我们编写好Filter，并配置对哪个web资源进行拦截后，WEB服务器每次在调用web资源的service方法之前，都会先调用一下filter的doFilter方法，因此，在该方法内编写代码可达到如下目的：</p>
<ol>
<li>调用目标资源之前，让一段代码执行。</li>
<li>是否调用目标资源（即是否让用户访问web资源）。</li>
<li>调用目标资源之后，让一段代码执行。</li>
</ol>
<p>web服务器在调用doFilter方法时，会传递一个filterChain对象进来，filterChain对象是filter接口中最重要的一个对 象，它也提供了一个doFilter方法，开发人员可以根据需求决定是否调用此方法，调用该方法，则web服务器就会调用web资源的service方 法，即web资源就会被访问，否则web资源不会被访问。</p>
<h4 id="Filter链"><a href="#Filter链" class="headerlink" title="Filter链"></a>Filter链</h4><p>在一个web应用中，可以开发编写多个Filter，这些Filter组合起来称之为一个Filter链。web服务器根据Filter在web.xml文件中的注册顺序，决定先调用哪个Filter，当第一个Filter的doFilter方法被调用时，web服务器会创建一个代表Filter链的FilterChain对象传递给该方法。在doFilter方法中，开发人员如果调用了FilterChain对象的doFilter方法，则web服务器会检查FilterChain对象中是否还有filter，如果有，则调用第2个filter，如果没有，则调用目标资源。</p>
<h2 id="Filter的生命周期"><a href="#Filter的生命周期" class="headerlink" title="Filter的生命周期"></a>Filter的生命周期</h2><h4 id="Filter的创建"><a href="#Filter的创建" class="headerlink" title="Filter的创建"></a>Filter的创建</h4><p>Filter的创建和销毁由web服务器负责。 web应用程序启动时，web服务器将创建Filter的实例对象，并调用其init方法，完成对象的初始化功能，从而为后续的用户请求作好拦截的准备工作，filter对象只会创建一次，init方法也只会执行一次。通过init方法的参数，可获得代表当前filter配置信息的FilterConfig对象。</p>
<h4 id="Filter的销毁"><a href="#Filter的销毁" class="headerlink" title="Filter的销毁"></a>Filter的销毁</h4><p>web容器调用destroy方法销毁Filter。destroy方法在Filter的生命周期中仅执行一次。在destroy方法中，可以释放过滤器使用的资源。</p>
<h4 id="FilterConfig接口"><a href="#FilterConfig接口" class="headerlink" title="FilterConfig接口"></a>FilterConfig接口</h4><p>用户在配置filter时，可以使用<init-param>为filter配置一些初始化参数，当web容器实例化Filter对象，调用其init方法时，会把封装了filter初始化参数的filterConfig对象传递进来。因此开发人员在编写filter时，通过filterConfig对象的方法，就可获得：</init-param></p>
<ul>
<li>String getFilterName()：得到filter的名称。</li>
<li>String getInitParameter(String name)： 返回在部署描述中指定名称的初始化参数的值。如果不存在返回null.</li>
<li>Enumeration getInitParameterNames()：返回过滤器的所有初始化参数的名字的枚举集合。</li>
<li>public ServletContext getServletContext()：返回Servlet上下文对象的引用。</li>
</ul>
<h2 id="Filter配置"><a href="#Filter配置" class="headerlink" title="Filter配置"></a>Filter配置</h2><h4 id="Filter实现"><a href="#Filter实现" class="headerlink" title="Filter实现"></a>Filter实现</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">public class EncodingFilter implements Filter &#123;  </div><div class="line">    private String encoding;  </div><div class="line">    private Map&lt;String, String&gt; params = new HashMap&lt;String, String&gt;();  </div><div class="line">    // 项目结束时就已经进行销毁  </div><div class="line">    public void destroy() &#123;  </div><div class="line">        //进行资源回收等，只调用一次</div><div class="line">    &#125;  </div><div class="line">    </div><div class="line">    public void doFilter(ServletRequest req, ServletResponse resp,  </div><div class="line">            FilterChain chain) throws IOException, ServletException &#123;  </div><div class="line">        //调用资源前的逻辑处理</div><div class="line">        ...</div><div class="line">        </div><div class="line">        //调用下一个过滤器，如果没有过滤器，则调用真正的service方法</div><div class="line">        chain.doFilter(req, resp);   </div><div class="line">        </div><div class="line">        //调用资源后的逻辑处理</div><div class="line">        ...</div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">    // 项目启动时就已经进行读取  </div><div class="line">    public void init(FilterConfig config) throws ServletException &#123;  </div><div class="line">        //初始化资源，在web容器启动时只调用一次</div><div class="line">    &#125;  </div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h4 id="注册Filter"><a href="#注册Filter" class="headerlink" title="注册Filter"></a>注册Filter</h4><p>开发好Filter之后，需要在web.xml文件中进行注册，这样才能够被web服务器调用。在web.xml文件中注册Filter范例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;filter&gt;  </div><div class="line">    &lt;description&gt;过滤器描述&lt;/description&gt;  </div><div class="line">    &lt;filter-name&gt;过滤器名称&lt;/filter-name&gt;  </div><div class="line">    &lt;filter-class&gt;过滤器地址&lt;/filter-class&gt;  </div><div class="line">    &lt;!--配置FilterTest过滤器的初始化参数--&gt;  </div><div class="line">    &lt;init-param&gt;  </div><div class="line">        &lt;description&gt;配置过滤器的初始化参数&lt;/description&gt;  </div><div class="line">        &lt;param-name&gt;name&lt;/param-name&gt;  </div><div class="line">        &lt;param-value&gt;gacl&lt;/param-value&gt;  </div><div class="line">    &lt;/init-param&gt;  </div><div class="line">    &lt;init-param&gt;  </div><div class="line">        &lt;description&gt;配置FilterTest过滤器的初始化参数&lt;/description&gt;  </div><div class="line">        &lt;param-name&gt;like&lt;/param-name&gt;  </div><div class="line">        &lt;param-value&gt;java&lt;/param-value&gt;  </div><div class="line">    &lt;/init-param&gt;  </div><div class="line">&lt;/filter&gt;</div></pre></td></tr></table></figure></p>
<ul>
<li><description>用于添加描述信息，该元素的内容可为空，<description>可以不配置。</description></description></li>
<li><filter-name>用于为过滤器指定一个名字，该元素的内容不能为空。</filter-name></li>
<li><filter-class>元素用于指定过滤器的完整的限定类名。</filter-class></li>
<li><init-param>元素用于为过滤器指定初始化参数，它的子元素<param-name>指定参数的名字，<param-value>指定参数的值。</param-value></param-name></init-param></li>
</ul>
<p>在过滤器中，<br>可以使用FilterConfig接口对象来访问初始化参数。如果过滤器不需要指定初始化参数，那么<init-param>元素可以不配置。</init-param></p>
<h4 id="映射Filter"><a href="#映射Filter" class="headerlink" title="映射Filter"></a>映射Filter</h4><p>在web.xml文件中注册了Filter之后，还要在web.xml文件中映射Filter<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;!--映射过滤器--&gt;</div><div class="line">&lt;filter-mapping&gt;</div><div class="line">  &lt;filter-name&gt;FilterTest&lt;/filter-name&gt;</div><div class="line">  &lt;!--“/*”表示拦截所有的请求 --&gt;</div><div class="line">  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</div><div class="line">&lt;/filter-mapping&gt;</div></pre></td></tr></table></figure></p>
<ul>
<li><filter-mapping>元素用于设置一个 Filter 所负责拦截的资源。一个Filter拦截的资源可通过两种方式来指定：Servlet 名称和资源访问的请求路径</filter-mapping></li>
<li><filter-name>子元素用于设置filter的注册名称。该值必须是在<filter>元素中声明过的过滤器的名字</filter></filter-name></li>
<li><url-pattern>设置 filter 所拦截的请求路径(过滤器关联的URL样式)</url-pattern></li>
<li><servlet-name>指定过滤器所拦截的Servlet名称。</servlet-name></li>
<li><p><dispatcher>指定过滤器所拦截的资源被 Servlet 容器调用的方式，可以是<code>REQUEST</code>,<code>INCLUDE</code>,<code>FORWARD</code>和<code>ERROR</code>之一，<strong>默认REQUEST</strong>。用户可以设置多个<dispatcher> 子元素用来指定 Filter 对资源的多种调用方式进行拦截。如下：</dispatcher></dispatcher></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;filter-mapping&gt;</div><div class="line">    &lt;filter-name&gt;testFilter&lt;/filter-name&gt;</div><div class="line">    &lt;url-pattern&gt;/index.jsp&lt;/url-pattern&gt;</div><div class="line">    &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;</div><div class="line">    &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;</div><div class="line">&lt;/filter-mapping&gt;</div></pre></td></tr></table></figure>
<p>  <dispatcher> 子元素可以设置的值及其意义：</dispatcher></p>
<ul>
<li>REQUEST：当用户直接访问页面时，Web容器将会调用过滤器。如果目标资源是通过RequestDispatcher的include()或forward()方法访问<br>时，那么该过滤器就不会被调用。</li>
<li>INCLUDE：如果目标资源是通过RequestDispatcher的include()方法访问时，那么该过滤器将被调用。除此之外，该过滤器不会被调用。</li>
<li>FORWARD：如果目标资源是通过RequestDispatcher的forward()方法访问时，那么该过滤器将被调用，除此之外，该过滤器不会被调用。</li>
<li>ERROR：如果目标资源是通过声明式异常处理机制调用时，那么该过滤器将被调用。除此之外，过滤器不会被调用。</li>
</ul>
</li>
</ul>

        </section>
    </article>
    
        
  </div>
  <aside>
    
    <div class="toc-container">
        <h1>目录</h1>
        <div class="content">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#概述"><span class="toc-number">1.</span> <span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Filter链"><span class="toc-number">1.0.1.</span> <span class="toc-text">Filter链</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Filter的生命周期"><span class="toc-number">2.</span> <span class="toc-text">Filter的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Filter的创建"><span class="toc-number">2.0.1.</span> <span class="toc-text">Filter的创建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Filter的销毁"><span class="toc-number">2.0.2.</span> <span class="toc-text">Filter的销毁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FilterConfig接口"><span class="toc-number">2.0.3.</span> <span class="toc-text">FilterConfig接口</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Filter配置"><span class="toc-number">3.</span> <span class="toc-text">Filter配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Filter实现"><span class="toc-number">3.0.1.</span> <span class="toc-text">Filter实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#注册Filter"><span class="toc-number">3.0.2.</span> <span class="toc-text">注册Filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#映射Filter"><span class="toc-number">3.0.3.</span> <span class="toc-text">映射Filter</span></a></li></ol></li></ol></li></ol>
        </div>
    </div>
    
  </aside>
</main>



  <footer>
  <div class="copyright">
    <div>
      &copy; 2018 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a>&nbsp
    </div>
    <div>
      Theme by <a href="https://github.com/lewis-geek/hexo-theme-Aath" target="_blank">Aath</a>
    </div>
  </div>
</footer>


<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="/lib/in-view.min.js"></script>
<script src="/lib/lodash.min.js"></script>
<script>
  var isDown = true
  var oldY = 0
  inView.offset(50)

  document.body.addEventListener('touchstart', function(){});
  
  window.addEventListener('scroll', _.throttle(e => {
    var currentY = window.scrollY
    if((oldY - currentY) < 0) {
      isDown = true
    } else {
      isDown = false
    }
    oldY = currentY
  }, 250))

  $("article img").each(function() {
      var strA = "<a data-fancybox='gallery' href='" + this.src + "'></a>";
      $(this).wrapAll(strA);
  });

  $('.toc-link').each(function() {
      var href = $(this).attr("href");
      
      inView(href).on('exit', () => {
        if (isDown) {
          handleActive(href)
        }
      })

      inView(href).on('enter', () => {
        if (!isDown) {
          handleActive(href)
        }
      })

      this.onclick = function(e) {
        var pos = $(href).offset().top - 10;
        $("html,body").animate({scrollTop: pos}, 300);
        setTimeout(() => {
          handleActive(href)
        }, 350)
        return false
      }
  })

  function handleActive(href) {
    document.querySelectorAll('.toc-link').forEach(elm => {
      elm.classList.remove('active')
    })
    document.querySelector(".toc [href='"+ href +"']").classList.add('active')
  }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.js"></script>


</body>
</html>
